!function(v){"use strict";Object.is||(Object.is=function(t,e){return t===e?0!==t||1/t==1/e:t!=t&&e!=e}),"function"!=typeof DataTransfer.prototype.setDragImage&&(DataTransfer.prototype.setDragImage=function(t,e,n){});function m(t){return t*Math.PI/180}function l(t){return(t<0?360:0)+t%360}var n=function(){var l="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof global&&global.global===global?global:this;function c(t,e,n){var i=new XMLHttpRequest;i.open("GET",t),i.responseType="blob",i.onload=function(){o(i.response,e,n)},i.onerror=function(){console.error("could not download file")},i.send()}function a(t){var e=new XMLHttpRequest;e.open("HEAD",t,!1);try{e.send()}catch(t){}return 200<=e.status&&e.status<=299}function r(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(t){var n=document.createEvent("MouseEvents");n.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(n)}}var o=l.saveAs||("object"!=typeof window||window!==l?function(){}:"download"in HTMLAnchorElement.prototype?function(t,e,n){var i=l.URL||l.webkitURL,o=document.createElement("a");e=e||t.name||"download",o.download=e,o.rel="noopener","string"==typeof t?(o.href=t,o.origin!==location.origin?a(o.href)?c(t,e,n):r(o,o.target="_blank"):r(o)):(o.href=i.createObjectURL(t),setTimeout(function(){i.revokeObjectURL(o.href)},4e4),setTimeout(function(){r(o)},0))}:"msSaveOrOpenBlob"in navigator?function(t,e,n){var i;e=e||t.name||"download","string"==typeof t?a(t)?c(t,e,n):((i=document.createElement("a")).href=t,i.target="_blank",setTimeout(function(){r(i)})):navigator.msSaveOrOpenBlob((t=t,void 0===(n=n)?n={autoBom:!1}:"object"!=typeof n&&(console.warn("Deprecated: Expected third argument to be a object"),n={autoBom:!n}),n.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(t.type)?new Blob([String.fromCharCode(65279),t],{type:t.type}):t),e)}:function(t,e,n,i){if((i=i||open("","_blank"))&&(i.document.title=i.document.body.innerText="downloading..."),"string"==typeof t)return c(t,e,n);var o,a,r,e="application/octet-stream"===t.type,n=/constructor/i.test(l.HTMLElement)||l.safari,s=/CriOS\/[\d]+/.test(navigator.userAgent);(s||e&&n)&&"object"==typeof FileReader?((o=new FileReader).onloadend=function(){var t=o.result,t=s?t:t.replace(/^data:[^;]*;/,"data:attachment/file;");i?i.location.href=t:location=t,i=null},o.readAsDataURL(t)):(a=l.URL||l.webkitURL,r=a.createObjectURL(t),i?i.location=r:location.href=r,i=null,setTimeout(function(){a.revokeObjectURL(r)},4e4))});return l.saveAs=o.saveAs=o}(),t="undefined"!=typeof Float32Array?Float32Array:Array;function g(t,e){this.reset().set(t,e)}var e,i,o,a,r;function s(t,e){this.plugin=null,this.$container=null,this.dom={},this.area=v.extend(!0,{},this.defaultArea),this.visible=!1,this.drag=!1,this.points=[new g,new g,new g,new g,new g,new g,new g,new g,new g,new g],this.type=null,this.tl_off=null,this.tr_off=null,this.br_off=null,this.bl_off=null,this.center_off=null,this.dblclick={clicks:0,timer:0,time:300},this._init(t,e)}function c(t,e){this.plugin=null,this.$container=null,this.dom={},this.callback=null,this.visible=!1,this.lockDrawing=!1,this.rect={x0:0,y0:0,x1:0,y1:0},this._init(t,e)}function u(){var i={alight:null,rootScope:null,wpFileFrameImage:null,tools:{transform:null,rectDrawing:null,activeTool:null},wp_base_url:null,wp_upload_url:null,wp_plugin_url:null,wp_ajax_url:null,wp_ajax_nonce:null,wp_ajax_action_update:null,wp_ajax_action_get:null,wp_ajax_action_modal:null,wp_ajax_msg_error:null,wp_item_id:null,themes:null,fonts:null,image:new Image,embedCodeWithId:null,embedCodeWithSlug:null,settings:{themeJavaScript:null,themeCSS:null},config:null,ui:{fullscreen:!1,builder:{leftSidebar:!0,leftSidebarWidth:350,rightSidebar:!0,rightSidebarWidth:350},canvas:{zoomStep:.05,zoom:1,x:0,y:0},prevCanvas:{zoom:1,x:0,y:0},moveCanvas:{initX:null,initY:null,lastX:null,lastY:null},sidebarResize:{initX:null,lastX:null,width:null},mapLayers:new Map,activeLayer:null,tabs:{builder:!0,customCSS:!1,customJS:!1,shortcode:!1},generalTab:{main:!1,container:!0},leftSidebarTabs:{general:!0,layers:!1},rightSidebarTabs:{layer:!0,popover:!1,tooltip:!1},layerTab:{general:!0,data:!0,appearance:!1},tooltipTab:{data:!1,appearance:!0},popoverTab:{data:!1,appearance:!0}},defaultConfig:{active:!0,title:null,slug:null,image:{relative:!1,url:null},imageWidth:0,imageHeight:0,autoWidth:!0,autoHeight:!0,containerWidth:null,containerHeight:null,theme:"light",class:null,containerId:null,background:{color:null,image:{relative:!1,url:null},size:null,repeat:null,position:null},customCSS:{active:!1,data:null},customJS:{active:!1,data:null},layers:[]},defaultLayer:{guid:null,id:null,type:"link",title:null,x:0,y:0,width:150,height:100,angle:0,autoWidth:!1,autoHeight:!1,lock:!1,visible:!0,scaling:!0,noevents:!1,className:null,url:null,urlNewWindow:!1,urlNoFollow:!0,contentData:null,userData:null,link:{normalColor:null,hoverColor:null,radius:0},text:{data:null,font:null,color:"#000",size:18,lineHeight:18,align:null,letterSpacing:null,background:{file:{url:null},color:null,size:"contain",repeat:"no-repeat",position:"50% 50%"}},image:{background:{file:{url:null,inlineEmbed:!1},color:null,size:"contain",repeat:"no-repeat",position:"50% 50%"}},tooltip:{active:!1,data:null,placement:"top",offset:{x:0,y:0},width:null,widthFromCSS:!1,trigger:"hover",followCursor:!1,scaling:!1,interactive:!0,smart:!1,showOnInit:!1,className:null,showAnimation:null,hideAnimation:null,duration:null},popover:{active:!1,data:null,type:"inbox",placement:"top",offset:{x:0,y:0},width:null,widthFromCSS:!1,trigger:"click",followCursor:!1,scaling:!1,interactive:!0,smart:!1,showOnInit:!1,mobileType:"inbox",className:null}},fn:{init:function(o){o.fn.enableLoading(o);const t=v("#vision-app-item");t.removeAttr("style"),v(window).on("resize",v.proxy(o.fn.onResize,this,o));var e,n=v("#vision-layers-canvas-wrap");if((o.plan=vision_globals.plan,o.tools.rectDrawing=new c(o,n),o.tools.transform=new s(o,n),o.wp_base_url=vision_globals.wp_base_url,o.wp_upload_url=vision_globals.upload_base_url,o.wp_plugin_url=vision_globals.plugin_base_url,o.wp_ajax_url=vision_globals.ajax_url,o.wp_ajax_nonce=vision_globals.ajax_nonce,o.wp_ajax_action_update=vision_globals.ajax_action_update,o.wp_ajax_action_get=vision_globals.ajax_action_get,o.wp_ajax_action_modal=vision_globals.ajax_action_modal,o.wp_ajax_msg_error=vision_globals.ajax_msg_error,o.msg_pro_title=vision_globals.msg_pro_title,o.msg_custom_js_error=vision_globals.msg_custom_js_error,o.msg_layer_id_error=vision_globals.msg_layer_id_error,o.wp_item_id=vision_globals.ajax_item_id,vision_globals.config)&&(e=v.extend(!0,{},o.defaultConfig,vision_globals.config))){for(var i in e)o.config.hasOwnProperty(i)&&(o.config[i]=e[i]);for(i=0;i<o.config.layers.length;i++){var a=v.extend(!0,{},o.defaultLayer,o.config.layers[i]);a.image.hasOwnProperty("backgroundImage")&&(a.image.background.file.url=a.image.backgroundImage.url,a.image.background.file.relative=a.image.backgroundImage.relative,a.image.background.position=a.image.backgroundPosition,a.image.background.repeat=a.image.backgroundRepeat,a.image.background.size=a.image.backgroundSize,delete a.image.backgroundImage,delete a.image.backgroundPosition,delete a.image.backgroundRepeat,delete a.image.backgroundSize),a.link.hasOwnProperty("url")&&(a.url=a.link.url,a.urlNewWindow=a.link.newWindow,delete a.link.url,delete a.link.newWindow,delete a.link.clickColor),a.guid||(a.guid=o.fn.uuid()),a.id||(a.id=o.fn.uuid(8)),(a.tooltip.offset.hasOwnProperty("x")||a.tooltip.offset.hasOwnProperty("y"))&&(a.tooltip.offset.top=a.tooltip.offset.y,a.tooltip.offset.left=a.tooltip.offset.x),(a.popover.offset.hasOwnProperty("x")||a.popover.offset.hasOwnProperty("y"))&&(a.popover.offset.top=a.popover.offset.y,a.popover.offset.left=a.popover.offset.x),o.config.layers[i]=a}}if(vision_globals.settings&&(e=v.extend(!0,{},vision_globals.settings)))for(var i in e)o.settings.hasOwnProperty(i)&&(o.settings[i]=e[i]);o.image.onload=function(t){var e=v("#vision-layers-image"),n=this;o.config.imageWidth=n.width,o.config.imageHeight=n.height,e.css({"background-image":"url("+n.src+")",width:n.width,height:n.height}),e.get(0).offsetHeight,o.fn.canvasZoomDefault(o),o.rootScope.scan()},o.image.onerror=function(t){var e=v("#vision-layers-image");o.config.imageWidth=0,o.config.imageHeight=0,e.css({"background-image":"url("+this.src+")",width:0,height:0}),o.fn.canvasZoomFit(o),o.rootScope.scan()},o.rootScope.watch("appData.config.image",function(t){t=o.fn.getImageUrl(o,t);o.image.src="",o.image.src=t},{deep:2}),o.rootScope.watch("appData.ui.canvas",function(t){v("#vision-layers-canvas").css({transform:"translate3d("+t.x+"px,"+t.y+"px,0) scale("+t.zoom+")"}),o.fn.updateTransformTool()},{deep:2}),o.rootScope.watch("appData.ui.activeLayer",function(t,e){e&&(v("#wp-vision-tooltip-editor-wrap").hasClass("html-active")?e.tooltip.data=v("#vision-tooltip-editor").val():null!==(n=tinyMCE.get("vision-tooltip-editor"))&&(e.tooltip.data=n.getContent()),v("#wp-vision-popover-editor-wrap").hasClass("html-active")?e.popover.data=v("#vision-popover-editor").val():null!==(n=tinyMCE.get("vision-popover-editor"))&&(e.popover.data=n.getContent()));e=t&&t.tooltip.data?t.tooltip.data:"";v("#wp-vision-tooltip-editor-wrap").hasClass("html-active")?v("#vision-tooltip-editor").val(e):null!==(n=tinyMCE.get("vision-tooltip-editor"))&&n.setContent(e);var n,e=t&&t.popover.data?t.popover.data:"";v("#wp-vision-popover-editor-wrap").hasClass("html-active")?v("#vision-popover-editor").val(e):null!==(n=tinyMCE.get("vision-popover-editor"))&&n.setContent(e)}),o.rootScope.watch("appData.ui.activeLayer",function(t,e){if(t&&e&&(t.x!=e.x||t.y!=e.y||t.width!=e.width||t.height!=e.height||t.angle!=e.angle)&&o.fn.updateTransformTool(),t&&e&&t.text&&t.text.data!=e.text.data){const n=o.ui.mapLayers.get(t),i=n.find(".vision-layer-inner");i.text(t.text.data)}null==t&&o.fn.hideTransformTool(),o.fn.hideRectDrawingTool()},{deep:3}),o.rootScope.watch("appData.ui.builder.leftSidebar",function(){o.fn.updateTransformTool()}),o.rootScope.watch("appData.ui.builder.rightSidebar",function(){o.fn.updateTransformTool()}),o.fn.loadData(o,"fonts").done(function(t){o.fonts=t.list}).always(function(){o.fn.loadData(o,"themes").done(function(t){o.themes=t.list}).always(function(){o.rootScope.scan(),o.fn.disableLoading(o)})})},enableLoading:function(t){v("#vision-app-item").removeClass("vision-active")},disableLoading:function(t){setTimeout(function(){v("#vision-app-item").addClass("vision-active")},1e3)},loadData:function(i,t,e){var o=v.Deferred();return v.ajax({url:i.wp_ajax_url,type:"POST",dataType:"json",data:{nonce:i.wp_ajax_nonce,action:i.wp_ajax_action_get,type:t,id:e},success:function(t){t&&t.success?o.resolve(t.data):this.error()},error:function(t,e,n){i.fn.showNotice(i,i.wp_ajax_msg_error,"notice-error"),o.resolve(null)}}),o.promise()},getPrewiewPageUrl:function(t){return new Url(t.wp_base_url+"/vision/map/"+t.wp_item_id+"?preview=1").toString()},preview:function(t){window.open(t.fn.getPrewiewPageUrl(t),"_blank")},getPluginConfig:function(e){var t={};t.title=e.config.title,t.imgSrc=e.fn.getImageUrl(e,e.config.image),!e.config.autoWidth&&e.config.containerWidth&&(t.width=e.config.containerWidth),!e.config.autoHeight&&e.config.containerHeight&&(t.height=e.config.containerHeight),t.theme=e.config.theme,t.className=e.config.class,t.flags={customCSS:e.config.customCSS.active,effects:!1};for(var n=[],i=[],o=0;o<e.config.layers.length;o++){var a=e.config.layers[o];a.visible&&(i.push({id:a.id,type:a.type,title:a.title,x:e.config.imageWidth?a.x/(e.config.imageWidth/2)*100:0,y:e.config.imageHeight?a.y/(e.config.imageHeight/2)*100:0,width:a.width,height:a.height,angle:a.angle,autoWidth:a.autoWidth,autoHeight:a.autoHeight,scaling:a.scaling,noevents:a.noevents,className:a.className,url:a.url,urlNewWindow:a.urlNewWindow,urlNoFollow:a.urlNoFollow,userData:a.userData,tooltip:{active:a.tooltip.active,trigger:a.tooltip.trigger,placement:a.tooltip.placement,offset:{top:a.tooltip.offset.top,left:a.tooltip.offset.left},width:a.tooltip.width,widthFromCSS:a.tooltip.widthFromCSS,followCursor:a.tooltip.followCursor,scaling:a.tooltip.scaling,interactive:a.tooltip.interactive,smart:a.tooltip.smart,showOnInit:a.tooltip.showOnInit,showAnimation:a.tooltip.showAnimation,hideAnimation:a.tooltip.hideAnimation,duration:a.tooltip.duration,className:a.tooltip.className},popover:{active:a.popover.active,type:a.popover.type,mobileType:a.popover.mobileType,trigger:a.popover.trigger,placement:a.popover.placement,offset:{top:a.popover.offset.top,left:a.popover.offset.left},width:a.popover.width,widthFromCSS:a.popover.widthFromCSS,followCursor:a.popover.followCursor,scaling:a.popover.scaling,interactive:a.popover.interactive,smart:a.popover.smart,showOnInit:a.popover.showOnInit,className:a.popover.className}}),"text"==a.type&&a.text.font&&n.push(a.text.font),(a.tooltip.showAnimation||a.tooltip.hideAnimation)&&(t.flags.effects=!0))}if(t.fonts=0<n.length?n:null,t.layers=0<i.length?i:null,e.config.customJS.active){t.onLoad=e.config.customJS.data;try{new Function(t.onLoad)}catch(t){e.fn.showNotice(e,e.msg_custom_js_error+": "+t.message,"notice-error")}}return t},saveConfig:function(e){e.fn.enableLoading(e),e.fn.saveEditorsData(e);for(var t=v.extend(!0,{},e.config),n=JSON.stringify(t),t=e.fn.getPluginConfig(e),t=JSON.stringify(t),i=0;i<e.config.layers.length;i++)for(var o=e.config.layers[i].id,a=i+1;a<e.config.layers.length;a++)if(e.config.layers[a].id==o)return e.fn.showNotice(e,e.msg_layer_id_error,"notice-error"),e.fn.showNotice(e,"layer.id = "+o,"notice-error"),void e.fn.disableLoading(e);v.ajax({url:e.wp_ajax_url,type:"POST",dataType:"json",data:{nonce:e.wp_ajax_nonce,action:e.wp_ajax_action_update,id:e.wp_item_id,data:n,config:t}}).done(function(t){return t?(e.wp_item_id=t.data.id,e.fn.showNotice(e,t.data.msg,t.success?"notice-success":"notice-error"),void e.rootScope.scan()):void e.fn.showNotice(e,e.wp_ajax_msg_error,"notice-error")}).fail(function(){e.fn.showNotice(e,e.wp_ajax_msg_error,"notice-error")}).always(function(){e.fn.disableLoading(e)})},loadConfigFromJson:function(t,e){e&&(e=JSON.parse(e),t.config=v.extend(!0,{},e),t.rootScope.scan())},loadConfigFromFile:function(t){var e=v("#vision-load-config-from-file").off("change");e.one("change",v.proxy(function(e,t){var n=t.target.files[0];t.target.value="",n&&((t=new FileReader).onload=v.proxy(function(t){t=t.target.result;e.fn.loadConfigFromJson(e,t)},this),t.readAsText(n))},this,t)),e.click()},saveConfigToFile:function(t){var e=v.extend(!0,{},t.config),e=JSON.stringify(e),t=t.wp_item_id?"vision_config_"+t.wp_item_id+".json":"vision_config.json",t=new File([e],t,{type:"application/json;charset=utf-8"});n(t)},showNotice:function(t,e,n){var i=v("#vision-messages"),o=v("<div></div>").addClass("notice is-dismissible").addClass(n),n=v("<p></p>").html(e),e=v("<button></button>").attr("type","button").addClass("notice-dismiss").html('<span class="screen-reader-text">Dismiss this notice.</span>');function a(){clearTimeout(o.data("timer")),o.fadeTo(100,0,function(){o.slideUp(100,function(){o.remove()})})}o.data("timer",setTimeout(a,5e3)),e.click(function(t){t.preventDefault(),a()}),o.append(n,e),i.append(o)},createBlob:function(t,e,n){return new Blob([e],{type:n})},createObjectURL:function(t,e,n){n=t.fn.createBlob(t,e,n);return URL.createObjectURL(n)},reverse:function(t,e){const n=[];for(let t=0;t<e.length;t++)n.unshift(e[t]);return n},getImageUrl:function(t,e,n){var i="";return e&&e.url&&0<e.url.length&&(i=e.relative?t.wp_upload_url+e.url:e.url,"style"==n&&(i="url("+i+")")),i},selectImage:function(n,i,o){n.wpFileFrameImage&&(n.wpFileFrameImage.detach(),n.wpFileFrameImage=null),n.wpFileFrameImage=wp.media.frames.file_frame=wp.media({library:{type:["image"]},multiple:!1}),n.wpFileFrameImage.on("select",function(t){var e=n.wpFileFrameImage.state().get("selection").first().toJSON().url;-1!==e.indexOf(n.wp_upload_url)?(e=e.replace(n.wp_upload_url,""),o.relative=!0):o.relative=!1,o.url=e,i.scan()}),n.wpFileFrameImage.open()},saveEditorsData:function(t){t.ui.activeLayer&&(v("#wp-vision-tooltip-editor-wrap").hasClass("html-active")?t.ui.activeLayer.tooltip.data=v("#vision-tooltip-editor").val():null!==(e=tinyMCE.get("vision-tooltip-editor"))&&(t.ui.activeLayer.tooltip.data=e.getContent()),v("#wp-vision-popover-editor-wrap").hasClass("html-active")?t.ui.activeLayer.popover.data=v("#vision-popover-editor").val():null!==(e=tinyMCE.get("vision-popover-editor"))&&(t.ui.activeLayer.popover.data=e.getContent()));var e=v("#vision-notepad-css");e.length&&(n=ace.edit(e.get(0)),t.config.customCSS.data=n.getSession().getValue());var n=v("#vision-notepad-js");n.length&&(n=ace.edit(n.get(0)),t.config.customJS.data=n.getSession().getValue())},onTab:function(t,e){if(!t.ui.tabs[e]){var n,i=t.ui.tabs;for(n in i)i.hasOwnProperty(n)&&(i[n]=!1);switch(t.ui.tabs[e]=!0,t.fn.saveEditorsData(t),t.rootScope.scan(),e){case"builder":break;case"customCSS":var o=v("#vision-notepad-css"),o=ace.edit(o.get(0));o.$blockScrolling=1/0,o.setTheme("ace/theme/monokai"),o.session.setMode("ace/mode/css"),t.settings.themeCSS&&o.setTheme("ace/theme/"+t.settings.themeCSS),t.config.customCSS.data&&o.getSession().setValue(t.config.customCSS.data);break;case"customJS":o=v("#vision-notepad-js"),o=ace.edit(o.get(0));o.$blockScrolling=1/0,o.setTheme("ace/theme/monokai"),o.session.setMode("ace/mode/javascript"),t.settings.themeJavaScript&&o.setTheme("ace/theme/"+t.settings.themeJavaScript),t.config.customJS.data&&o.getSession().setValue(t.config.customJS.data)}}},onLeftSidebarTab:function(t,e){if(!t.ui.leftSidebarTabs[e]){var n,i=t.ui.leftSidebarTabs;for(n in i)i.hasOwnProperty(n)&&(i[n]=!1);t.ui.leftSidebarTabs[e]=!0}},onRightSidebarTab:function(t,e){if(!t.ui.rightSidebarTabs[e]){var n,i=t.ui.rightSidebarTabs;for(n in i)i.hasOwnProperty(n)&&(i[n]=!1);t.ui.rightSidebarTabs[e]=!0}},onGeneralTab:function(t,e){t.ui.generalTab[e]=!t.ui.generalTab[e]},onLayerTab:function(t,e){t.ui.layerTab[e]=!t.ui.layerTab[e]},onTooltipTab:function(t,e){t.ui.tooltipTab[e]=!t.ui.tooltipTab[e]},onPopoverTab:function(t,e){t.ui.popoverTab[e]=!t.ui.popoverTab[e]},onResize:function(t,e){t.fn.updateTransformTool()},toggleSidebarPanel:function(t,e){"left"===e?t.ui.builder.leftSidebar=!t.ui.builder.leftSidebar:t.ui.builder.rightSidebar=!t.ui.builder.rightSidebar,t.rootScope.scan()},canvasZoomIn:function(t){var e=(.01===t.ui.canvas.zoom?0:t.ui.canvas.zoom)+t.ui.canvas.zoomStep,e=parseFloat(parseFloat(e).toFixed(2));t.ui.prevCanvas.zoom=t.ui.canvas.zoom,t.ui.canvas.zoom=e},canvasZoomOut:function(t){var e=t.ui.canvas.zoom-t.ui.canvas.zoomStep,e=parseFloat(parseFloat(e).toFixed(2));t.ui.prevCanvas.zoom=t.ui.canvas.zoom,t.ui.canvas.zoom=e<=0?.01:e},canvasZoomDefault:function(t){t.ui.prevCanvas.zoom=t.ui.canvas.zoom,t.ui.canvas.zoom=1},canvasZoomFit:function(t){var e=v("#vision-layers-image"),n=v("#vision-layers-canvas-wrap"),i=e.width()?n.width()/e.width():0,n=e.height()?n.height()/e.height():0,e=1,e=n<i?n:i;t.ui.prevCanvas.zoom=t.ui.canvas.zoom,t.ui.canvas.zoom=e,t.ui.prevCanvas.x=t.ui.canvas.x,t.ui.prevCanvas.y=t.ui.canvas.y,t.ui.canvas.x=t.ui.canvas.y=0},canvasMoveDefault:function(t){t.ui.prevCanvas.x=t.ui.canvas.x,t.ui.prevCanvas.y=t.ui.canvas.y,t.ui.canvas.x=0,t.ui.canvas.y=0},getCanvasZoomForLabel:function(t){t=parseFloat(parseFloat(100*t.ui.canvas.zoom).toFixed(2));return parseInt(t,10)},getCanvasZoom:function(t){return t.ui.canvas.zoom},getCanvasPosition:function(t){return{x:t.ui.canvas.x,y:t.ui.canvas.y}},initLayer:function(t,e,n){t.ui.mapLayers.set(e,v(n))},initLayerInner:function(t,e,n){"text"==e.type&&e.text.data&&v(n).html(e.text.data)},selectLayer:function(t,e){t.ui.activeLayer=e,t.rootScope.scan();var n=t.ui.mapLayers.get(e);n&&n.trigger("focus"),t.fn.hideTransformTool(),e&&!e.lock&&e.visible&&!n.hasClass("vision-editing")&&t.fn.showTransformTool(e)},isLayerActive:function(t,e){return Object.is(t.ui.activeLayer,e)},onLayerItemClick:function(t,e){t.fn.isLayerActive(t,e)?t.ui.activeLayer=null:t.fn.selectLayer(t,e)},onLayerClick:function(t,e){if(t.fn.isLayerActive(t,e)){const n=t.ui.mapLayers.get(e);n&&n.trigger("focus")}else t.fn.selectLayer(t,e)},onLayerKeyDown:function(t,e,n){var i=t.ui.mapLayers.get(e);if(!e.lock&&!i.hasClass("vision-editing")){var o=!1;switch(n.which){case 37:--e.x,o=!0;break;case 38:--e.y,o=!0;break;case 39:e.x+=1,o=!0;break;case 40:e.y+=1,o=!0}o&&(n.preventDefault(),n.stopPropagation(),t.rootScope.scan())}},prevLayer:function(t){if(0!=t.config.layers.length)if(t.ui.activeLayer){for(var e=t.config.layers.length-1;0<e&&!Object.is(t.config.layers[e],t.ui.activeLayer);e--);e=e-1<0?t.config.layers.length-1:e-1,t.fn.selectLayer(t,t.config.layers[e])}else 0<t.config.layers.length&&t.fn.selectLayer(t,t.config.layers[t.config.layers.length-1])},nextLayer:function(t){if(0!=t.config.layers.length)if(t.ui.activeLayer){for(var e=0;e<t.config.layers.length&&!Object.is(t.config.layers[e],t.ui.activeLayer);e++);e=e+1>=t.config.layers.length?0:e+1,t.fn.selectLayer(t,t.config.layers[e])}else 0<t.config.layers.length&&t.fn.selectLayer(t,t.config.layers[0])},addLayerLink:function(t){t.fn.showRectDrawingTool("link")},addLayerText:function(t){t.fn.showRectDrawingTool("text")},addLayerImage:function(t){t.fn.showRectDrawingTool("image")},copyLayer:function(t){if(null!=t.ui.activeLayer){for(var e=null,n=t.config.layers.length,i=null,o=0;o<n;o++)if(i=t.config.layers[o],Object.is(t.ui.activeLayer,i)){e=o;break}null!=e&&((i=v.extend(!0,{},i)).guid=t.fn.uuid(),i.id=t.fn.uuid(8),i.title=i.title||i.type,i.title=i.title+(i.title.includes("[copy]")?"":" [copy]"),t.config.layers.splice(e+1,0,i),t.fn.selectLayer(t,i))}},updownLayer:function(t,e){if(null!=t.ui.activeLayer){for(var n=null,i=t.config.layers.length,o=null,a=0;a<i;a++)if(o=t.config.layers[a],Object.is(t.ui.activeLayer,o)){n=a;break}null!=n&&("up"==e&&0<n?(t.config.layers[n]=t.config.layers[n-1],t.config.layers[n-1]=o):"down"==e&&n<i-1&&(t.config.layers[n]=t.config.layers[n+1],t.config.layers[n+1]=o))}},deleteLayer:function(t){if(null!=t.ui.activeLayer){for(var e,n=null,i=t.config.layers.length,o=0;o<i;o++){var a=t.config.layers[o];if(Object.is(t.ui.activeLayer,a)){n=o;break}}null!=n&&(0<=(e=n)&&n<i&&(t.config.layers.splice(n,1),n==i-1&&1<i?e=i-2:1==i&&(e=null)),t.fn.selectLayer(t,t.config.layers[e]))}},editLayerAlign:function(t,e){if(null!=t.ui.activeLayer){var n=t.ui.activeLayer;switch(e){case"top":n.y=-t.config.imageHeight/2+n.height/2;break;case"middle":n.y=0;break;case"bottom":n.y=t.config.imageHeight/2-n.height/2;break;case"left":n.x=-t.config.imageWidth/2+n.width/2;break;case"center":n.x=0;break;case"right":n.x=t.config.imageWidth/2-n.width/2}}},toggleLayerPopover:function(t,e){e.popover.active=!e.popover.active},toggleLayerTooltip:function(t,e){e.tooltip.active=!e.tooltip.active},toggleLayerVisible:function(t,e){e.visible=!e.visible,t.ui.activeLayer&&t.ui.activeLayer.guid==e.guid&&(e.visible?t.fn.showTransformTool(e):t.fn.hideTransformTool())},toggleLayerLock:function(t,e){e.lock=!e.lock,t.ui.activeLayer&&t.ui.activeLayer.guid==e.guid&&(e.lock?t.fn.hideTransformTool():t.fn.showTransformTool(e))},getLayerStyle:function(t,e,n){switch(n){case"x":return e.x-e.width/2+"px";case"y":return e.y-e.height/2+"px";case"width":return e.width+"px";case"height":return e.height+"px";case"angle":return e.angle?"rotate("+e.angle+"deg)":"rotate(0deg)";case"border-radius":return"link"===e.type?e.link.radius||"":null;case"background-color":switch(e.type){case"link":return e.link.normalColor||"";case"image":return e.image.background.color||"";case"text":return e.text.background.color||""}return null;case"background-image":switch(e.type){case"image":return t.fn.getImageUrl(t,e.image.background.file,"style");case"text":return t.fn.getImageUrl(t,e.text.background.file,"style");case"svg":return t.fn.getImageUrl(t,e.svg.file,"style")}return null;case"background-size":switch(e.type){case"image":return e.image.background.size||"";case"text":return e.text.background.size||"";case"svg":return"100% 100%"}return null;case"background-repeat":switch(e.type){case"image":return e.image.background.repeat||"";case"text":return e.text.background.repeat||""}return null;case"background-position":switch(e.type){case"image":return e.image.background.position||"";case"text":return e.text.background.position||""}return null;case"color":return"text"===e.type?e.text.color:null;case"font-family":if("text"!=e.type)return null;if(e.text.font){var i,o,a=e.text.font.replace(new RegExp("[+]|[:]","g"),"");return 0==v("#"+a).length&&(i=document.getElementsByTagName("head")[0],(o=document.createElement("link")).setAttribute("id",a),o.setAttribute("rel","stylesheet"),o.setAttribute("href","https://fonts.googleapis.com/css?family="+e.text.font),i.appendChild(o)),'"'+e.text.font.replace(new RegExp("[+]","g")," ")+'", sans-serif'}return"sans-serif";case"font-size":return"text"==e.type?(0<e.text.size?e.text.size:0)+"px":null;case"line-height":return"text"==e.type?(0<e.text.lineHeight?e.text.lineHeight:0)+"px":null;case"letter-spacing":return"text"==e.type?(0<e.text.letterSpacing?e.text.letterSpacing:0)+"px":null;case"text-align":if("text"==e.type)return e.text.align||""}return null},getLayerCoord:function(t,e,n){switch(n){case"x":return parseFloat(parseFloat(e.x).toFixed(2));case"y":return parseFloat(parseFloat(e.y).toFixed(2));case"w":return parseFloat(parseFloat(e.width).toFixed(2));case"h":return parseFloat(parseFloat(e.height).toFixed(2));case"angle":return Math.floor(e.angle)}return""},showTransformTool:function(t){i.tools.transform.init(t),i.tools.transform.start()},hideTransformTool:function(){i.tools.transform.end()},updateTransformTool:function(){i.tools.transform.isVisible()&&i.tools.transform.update()},showRectDrawingTool:function(n){i.fn.selectLayer(i,null),i.tools.activeTool=n,i.tools.rectDrawing.start(t=>{if(i.tools.activeTool=null,0<t.w&&0<t.h){const e=v.extend(!0,{},i.defaultLayer);e.x=t.x,e.y=t.y,e.width=t.w,e.height=t.h,e.guid=i.fn.uuid(),e.id=i.fn.uuid(8),e.type=n,i.config.layers.push(e),i.fn.selectLayer(i,e)}else i.fn.selectLayer(i,null)})},hideRectDrawingTool:function(){i.tools.activeTool=null,i.tools.rectDrawing.end(!0)},onMoveCanvasStart:function(t,e){(1===e.button||0===e.button&&e.ctrlKey)&&(e.preventDefault(),e.stopPropagation(),t.ui.moveCanvas.initX=e.pageX,t.ui.moveCanvas.initY=e.pageY,t.ui.moveCanvas.lastX=e.pageX,t.ui.moveCanvas.lastY=e.pageY,v("body").on("mousemove",v.proxy(t.fn.onMoveCanvas,this,t)),v("body").on("mouseup",v.proxy(t.fn.onMoveCanvasEnd,this,t)),v("body").on("mouseleave",v.proxy(t.fn.onMoveCanvasEnd,this,t)))},onMoveCanvas:function(t,e){e.preventDefault(),e.stopPropagation();var n=e.pageX-t.ui.moveCanvas.lastX,i=e.pageY-t.ui.moveCanvas.lastY;t.ui.moveCanvas.lastX=e.pageX,t.ui.moveCanvas.lastY=e.pageY,t.ui.prevCanvas.x=t.ui.canvas.x,t.ui.prevCanvas.y=t.ui.canvas.y,t.ui.canvas.x+=n,t.ui.canvas.y+=i,t.rootScope.scan()},onMoveCanvasEnd:function(t,e){e.preventDefault(),e.stopPropagation(),v("body").off("mousemove",v.proxy(t.fn.onMoveCanvas,this,t)),v("body").off("mouseup",v.proxy(t.fn.onMoveCanvasEnd,this,t)),v("body").off("mouseleave",v.proxy(t.fn.onMoveCanvasEnd,this,t)),t.ui.moveCanvas.initX=null,t.ui.moveCanvas.initY=null,t.ui.moveCanvas.lastX=null,t.ui.moveCanvas.lastY=null},onSidebarResizeStart:function(t,e,n){e.preventDefault(),e.stopPropagation(),t.ui.sidebarResize.initX=e.pageX,t.ui.sidebarResize.lastX=e.pageX,t.ui.sidebarResize.width="left"===n?t.ui.builder.leftSidebarWidth:t.ui.builder.rightSidebarWidth,v("body").on("mousemove",v.proxy(t.fn.onSidebarResize,this,t,n)),v("body").on("mouseup",v.proxy(t.fn.onSidebarResizeEnd,this,t)),v("body").on("mouseleave",v.proxy(t.fn.onSidebarResizeEnd,this,t))},onSidebarResize:function(t,e,n){n.preventDefault(),n.stopPropagation();var i=n.pageX-t.ui.sidebarResize.lastX;t.ui.sidebarResize.lastX=n.pageX,"left"===e?t.ui.sidebarResize.width+=i:t.ui.sidebarResize.width-=i,350<=t.ui.sidebarResize.width&&t.ui.sidebarResize.width<=800&&("left"===e?t.ui.builder.leftSidebarWidth=t.ui.sidebarResize.width:t.ui.builder.rightSidebarWidth=t.ui.sidebarResize.width,t.rootScope.scan()),t.fn.updateTransformTool()},onSidebarResizeEnd:function(t,e){e.preventDefault(),e.stopPropagation(),v("body").off("mousemove",v.proxy(t.fn.onSidebarResize,this,t)),v("body").off("mouseup",v.proxy(t.fn.onSidebarResizeEnd,this,t)),v("body").off("mouseleave",v.proxy(t.fn.onSidebarResizeEnd,this,t)),t.ui.sidebarResize.initX=null,t.ui.sidebarResize.lastX=null,t.ui.sidebarResize.width=null},selectShowAnimation:function(e,n){var i={selectedClass:null};e.modal.fn.show(e,"show-effects",i,e.fn.selectAnimationCallback).then(function(t){e.modal.fn.close(e,i.id),"close"!=t&&t&&(n.showAnimation=i.selectedClass,e.rootScope.scan())})},selectHideAnimation:function(e,n){var i={selectedClass:null};e.modal.fn.show(e,"hide-effects",i,e.fn.selectAnimationCallback).then(function(t){e.modal.fn.close(e,i.id),"close"!=t&&t&&(n.hideAnimation=i.selectedClass,e.rootScope.scan())})},selectAnimationCallback:function(i){v("#vision-modal-"+i.id).find(".vision-modal-effect[data-fx-name]").on("click",function(t){var e=v(this),n=e.data("fx-name");e.removeClass(n).addClass(n),i.selectedClass=n,i.rootScope.scan()}),v("#vision-modal-"+i.id).find(".vision-modal-effect[data-fx-name]").on("dblclick",function(t){var e=v(this).data("fx-name");i.selectedClass=e,i.deferred.resolve(!0)}),v("#vision-modal-"+i.id).find(".vision-modal-effect[data-fx-name]").on(function(){var t,e=document.createElement("fakeelement"),n={animation:"animationend",MSAnimationEnd:"msAnimationEnd",OAnimation:"oAnimationEnd",MozAnimation:"mozAnimationEnd",WebkitAnimation:"webkitAnimationEnd"};for(t in n)if(void 0!==e.style[t])return n[t]}(),function(t){var e=v(this),n=e.data("fx-name");e.hasClass(n)&&e.removeClass(n)})},floor:function(t,e){return Math.floor(e)},assignObject:function(t,e,n){for(var i in e)n.hasOwnProperty(i)&&(n[i]=e[i])},copyToClipboard:function(t,e){var n=v(e);if(0!=n.length){var i=n.val();if(window.clipboardData&&window.clipboardData.setData)return clipboardData.setData("Text",i);if(document.queryCommandSupported&&document.queryCommandSupported("copy")){e=document.createElement("textarea");e.textContent=i,e.style.position="fixed",document.body.appendChild(e),e.select();try{document.execCommand("copy")}catch(t){console.warn("Copy to clipboard failed.",t)}finally{document.body.removeChild(e)}}n.select()}},generateLayerId:function(n,t,e){for(var i=n.fn.uuid(8);!function(t){for(var e=0;e<n.config.layers.length;e++)if(n.config.layers[e].id==t)return;return 1}(i);)i=n.fn.uuid();e.id=i,t.scan()},uuid:function(t){var e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)});return 0<t?e.substring(0,t):e}},modal:{count:0,items:[],fn:{resize:function(t){var e=v("#vision-modal-"+t.id),n=(e.find(".vision-modal-dialog"),e.find(".vision-modal-header")),t=e.find(".vision-modal-data"),e=e.find(".vision-modal-footer"),n=n.outerHeight()+e.outerHeight()+50,e=v(window).height();e-n<t.height()&&t.outerHeight(e-n)},show:function(i,t,n,e){var o=++i.modal.count,a=v.Deferred();return i.modal.items.push(o),i.inprocess++,v.ajax({url:i.wp_ajax_url,type:"GET",dataType:"html",data:{nonce:i.wp_ajax_nonce,action:i.wp_ajax_action_modal,name:t}}).done(function(t){v("body").addClass("vision-modal-open");var t=v(t),e={};e.modalData=n,e.modalData.id=o,e.modalData.deferred=a,e.modalData.appData=i,null!=n.easyClose&&!n.easyClose||t.on("click",function(t){e.modalData.deferred.resolve("close")}),v("#vision-modals").append(t),t.find(".vision-modal-dialog").on("click",function(t){return!1}),n.rootScope=i.alight(t.get(0),e),i.modal.fn.resize(n)}).fail(function(t,e,n){i.fn.showNotice(i,i.wp_ajax_msg_error,"notice-error")}).always(function(){e&&"function"==typeof e&&e.call(this,n),i.inprocess--}),a.promise()},close:function(t,e){v("#vision-modal-"+e).remove();e=t.modal.items.indexOf(e);t.modal.items.splice(e,1),0==t.modal.items.length&&jQuery("body").removeClass("vision-modal-open")}}}};window.alightInitCallback=function(t){delete window.alightInitCallback,t.directives.al.uuid={restrict:"EA",link:function(i,t,o,a){var r=v(t),s=v(t);s.on("input change",function(t){var e=s.val(),n=!0;!function(t){return!t||/^\s*$/.test(t)}(e)&&e.match("^[a-zA-Z0-9_-]+$")||(n=!1);n?(a.setValue(o,e),a.scan(),function(){var t=r.data("callback");t&&a.changeDetector.compile(t)(i)}(),r.removeClass("vision-invalid")):r.addClass("vision-invalid")}),a.watch(o,function(t){null==t?s.val(null):s.val(t)},{readOnly:!0})}},t.directives.al.text={restrict:"EA",link:function(n,t,i,o){var a=v(t),r=v(t);r.on("input change",function(t){var e=r.val();!function(t){return!t||/^\s*$/.test(t)}(e)||(e=null);o.setValue(i,e),o.scan(),function(){var t=a.data("callback");t&&o.changeDetector.compile(t)(n)}()}),o.watch(i,function(t){null==t?r.val(null):r.val(t)},{readOnly:!0})}},t.directives.al.textarea={restrict:"EA",link:function(n,t,i,o){var a=v(t),r=v(t);a.addClass("vision-textarea"),r.on("input change",function(t){var e=r.val();!function(t){return!t||/^\s*$/.test(t)}(e)||(e=null);o.setValue(i,e),o.scan(),function(){var t=a.data("callback");t&&o.changeDetector.compile(t)(n)}()}),o.watch(i,function(t){null==t?r.val(null):r.val(t)},{readOnly:!0})}},t.directives.al.integer={restrict:"EA",link:function(i,t,o,a){var r=v(t),s=v(t);s.on("input change",function(t){var e=s.val(),n=!0;!function(t){return!t||/^\s*$/.test(t)}(e)?e.match("^([+-]?[1-9]+[0-9]*|0)$")?e=parseInt(e,10):n=!1:e=null;n?(a.setValue(o,e),a.scan(),function(){var t=r.data("callback");t&&a.changeDetector.compile(t)(i)}(),r.removeClass("vision-invalid")):r.addClass("vision-invalid")}),a.watch(o,function(t){r.removeClass("vision-invalid"),null==t?s.val(null):s.val(t)},{readOnly:!0})}},t.directives.al.float={restrict:"EA",link:function(i,t,o,a){var r=v(t),s=v(t);s.on("input change",function(t){var e=s.val(),n=!0;!function(t){return!t||/^\s*$/.test(t)}(e)?e.match("^[+-]?([0-9]+([.][0-9]*)?|[.][0-9]+)$")?e=parseFloat(e):n=!1:e=null;n?(a.setValue(o,e),a.scan(),function(){var t=r.data("callback");t&&a.changeDetector.compile(t)(i)}(),r.removeClass("vision-invalid")):r.addClass("vision-invalid")}),a.watch(o,function(t){r.removeClass("vision-invalid"),null==t?s.val(null):s.val(t)},{readOnly:!0})}},t.directives.al.toggle={restrict:"EA",link:function(e,t,n,i){var o=v(t);o.addClass("vision-toggle").html("&nbsp;"),o.on("mousedown touchstart",function(t){i.setValue(n,!i.getValue(n)),i.scan(),function(){var t=o.data("callback");t&&i.changeDetector.compile(t)(e)}()}),i.watch(n,function(t){t?o.addClass("vision-checked").removeClass("vision-unchecked"):o.removeClass("vision-checked").addClass("vision-unchecked")},{readOnly:!0})}},t.directives.al.checkbox={restrict:"EA",link:function(e,t,n,i){var o=v(t);o.addClass("vision-checkbox").html('<i class="vision-icon vision-icon-check"></i>'),o.on("mousedown touchstart",function(t){i.setValue(n,!i.getValue(n)),i.scan(),function(){var t=o.data("callback");t&&i.changeDetector.compile(t)(e)}()}),i.watch(n,function(t){t?o.addClass("vision-checked").removeClass("vision-unchecked"):o.removeClass("vision-checked").addClass("vision-unchecked")},{readOnly:!0})}},t.directives.al.unit={restrict:"EA",link:function(e,t,i,o){var n=v(t),a=v("<input/>").addClass("vision-unit-value"),r=v("<select/>").addClass("vision-unit-type");function s(){var t=n.data("callback");t&&o.changeDetector.compile(t)(e)}r.append('<option value="px">px</li>'),r.append('<option value="%">%</li>'),r.append('<option value="em">em</li>'),r.append('<option value="cm">cm</li>'),r.append('<option value="mm">mm</li>'),r.append('<option value="in">in</li>'),r.append('<option value="pt">pt</li>'),r.append('<option value="pc">pc</li>'),r.append('<option value="ex">ex</li>'),r.append('<option value="ch">ch</li>'),r.append('<option value="rem">rem</li>'),r.append('<option value="vw">vw</li>'),r.append('<option value="vh">vh</li>'),r.append('<option value="vmin">vmin</li>'),r.append('<option value="vmax">vmax</li>'),n.append(a,r),a.on("input change",function(t){var e=a.val(),n=!0;!function(t){return!t||/^\s*$/.test(t)}(e)?e.match("^[+-]?([0-9]+([.][0-9]*)?|[.][0-9]+)$")?e={value:parseFloat(e),type:r.val()}:n=!1:e={value:null,type:r.val()};n?(o.setValue(i,e),o.scan(),s(),a.removeClass("vision-invalid")):a.addClass("vision-invalid")}),r.on("change",function(t){var e=r.val(),n=o.getValue(i);n&&(n.type=e,o.setValue(i,n),o.scan(),s())}),o.watch(i,function(t){a.removeClass("vision-invalid"),null==t?(a.val(null),r.val("px")):(a.val(t.value),r.val(t.type))},{readOnly:!0})}},t.directives.al.style={restrict:"EA",link:function(t,e,n,i){var o,a;i.attrArgument&&(o=v(e),a=i.attrArgument.split(".")[0],i.watch(n,function(t){o.css(a,t)},{readOnly:!0}))}},t.directives.al.backgroundrepeat={restrict:"EA",link:function(t,e,n,i){var e=v(e),o=v("<select/>").addClass(e.get(0).className);o.append('<option value="none">none</option>'),o.append('<option value="repeat">repeat</option>'),o.append('<option value="repeat-x">repeat-x</option>'),o.append('<option value="repeat-y">repeat-y</option>'),o.append('<option value="no-repeat">no-repeat</option>'),e.append(o),o.unwrap(),o.on("change",function(t){var e=o.val();"none"==e&&(e=null);i.setValue(n,e),i.scan()}),i.watch(n,function(t){null==t?o.val("none"):o.val(t)},{readOnly:!0})}},t.directives.al.backgroundsize={restrict:"EA",link:function(t,e,n,i){var e=v(e),o=v("<select/>").addClass(e.get(0).className);o.append('<option value="none">none</option>'),o.append('<option value="auto">auto</option>'),o.append('<option value="cover">cover</option>'),o.append('<option value="contain">contain</option>'),o.append('<option value="100% 100%">stretch</option>'),e.append(o),o.unwrap(),o.on("change",function(t){var e=o.val();"none"==e&&(e=null);i.setValue(n,e),i.scan()}),i.watch(n,function(t){null==t?o.val("none"):o.val(t)},{readOnly:!0})}},t.directives.al.textfont={restrict:"EA",link:function(t,e,n,i){for(var e=v(e),o=v("<select/>").addClass(e.get(0).className),a=i.getValue(e.data("fonts")),r=0;r<a.length;r++){var s=a[r].fontname.replace(new RegExp("[+]","g")," "),l=a[r].fontname;o.append('<option value="'+l+'">'+s+"</option>")}e.append(o),o.unwrap(),o.on("change",function(t){var e=o.val();"none"==e&&(e=null);i.setValue(n,e),i.scan()}),i.watch(n,function(t){null==t?o.val("none"):o.val(t)},{readOnly:!0})}},t.directives.al.textalign={restrict:"EA",link:function(t,e,n,i){var e=v(e),o=v("<select/>").addClass(e.get(0).className);o.append('<option value="none">none</option>'),o.append('<option value="left">left</option>'),o.append('<option value="right">right</option>'),o.append('<option value="center">center</option>'),o.append('<option value="justify">justify</option>'),e.append(o),o.unwrap(),o.on("change",function(t){var e=o.val();"none"==e&&(e=null);i.setValue(n,e),i.scan()}),i.watch(n,function(t){null==t?o.val("none"):o.val(t)},{readOnly:!0})}},t.directives.al.color={restrict:"EA",link:function(e,i,o,a){var n=v(i),r=v("<div></div>").addClass("vision-color-btn").append("<div><div></div></div>"),s=v("<input/>").addClass("vision-color-value");n.append(r,s),r.on("click touchend",function(t){u.show(r,a.getValue(o))}),s.on("input change",function(t){var e=v(this).val(),n=!0;!function(t){return!t||/^\s*$/.test(t)}(e)?(new c).setColor(e)||(n=!1):e=null;n?(a.setValue(o,e),a.scan(),p(),v(i).removeClass("vision-invalid")):v(i).addClass("vision-invalid")});var l=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(t){return[t[1],t[2],t[3],t[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(t){return[2.55*t[1],2.55*t[2],2.55*t[3],t[4]]}},{re:/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/,parse:function(t){return[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]}}];function c(){this.rgb={r:0,g:0,b:0},this.hsb={h:0,s:0,b:0},this.alpha=1}function t(t){this.config=null,this.color=new c,this.controls={},this.inputEdit={enabled:!1,pageY:0,value:0,type:null},this._init(t)}c.prototype={rgb:function(){return"rgb("+this.rgb.r+","+this.rgb.g+","+this.rgb.b+")"},rgba:function(){return"rgba("+this.rgb.r+","+this.rgb.g+","+this.rgb.b+","+this.alpha+")"},hex:function(){return this.toHex()},RGBAtoHSBA:function(t,e,n,i){var o,a,r=0,s=Math.max(t,e,n),l=s-Math.min(t,e,n),c=s/255,u=0!=s?l/s:0;return u&&(o=(s-t)/l,a=(s-e)/l,l=(s-n)/l,r=t==s?l-a:e==s?2+o-l:4+a-o,(r/=6)<0&&r++),{h:Math.round(360*r),s:Math.round(100*u),b:Math.round(100*c),a:i||1}},HSBAtoRGBA:function(t,e,n,i){var o,a,r;return t=(t=t)%360/60,n=o=a=(n=n/100)-(r=n*(e=e/100)),n+=[r,e=r*(1-Math.abs(t%2-1)),0,0,e,r][t=~~t],o+=[e,r,r,e,0,0][t],a+=[0,0,e,r,r,e][t],{r:Math.round(255*n),g:Math.round(255*o),b:Math.round(255*a),a:i||1}},setColor:function(t){for(var e in t=t.toLowerCase(),l)if(l.hasOwnProperty(e)){var n=l[e],e=n.re.exec(t),n=e&&n.parse(e);if(n){e=this.RGBAtoHSBA.apply(null,n);return this.hsb={h:e.h,s:e.s,b:e.b},this.rgb={r:n[0],g:n[1],b:n[2]},this.alpha=e.a,!0}}return!1},setRed:function(t){255<t?t=255:t<0&&(t=0),this.rgb.r=t;t=this.RGBAtoHSBA(this.rgb.r,this.rgb.g,this.rgb.b);this.hsb={h:t.h,s:t.s,b:t.b}},setGreen:function(t){255<t?t=255:t<0&&(t=0),this.rgb.g=t;t=this.RGBAtoHSBA(this.rgb.r,this.rgb.g,this.rgb.b);this.hsb={h:t.h,s:t.s,b:t.b}},setBlue:function(t){255<t?t=255:t<0&&(t=0),this.rgb.b=t;t=this.RGBAtoHSBA(this.rgb.r,this.rgb.g,this.rgb.b);this.hsb={h:t.h,s:t.s,b:t.b}},setHue:function(t){360<t?t=360:t<0&&(t=0),this.hsb.h=t;t=this.HSBAtoRGBA(this.hsb.h,this.hsb.s,this.hsb.b);this.rgb={r:t.r,g:t.g,b:t.b}},setSaturation:function(t){100<t?t=100:t<0&&(t=0),this.hsb.s=t;t=this.HSBAtoRGBA(this.hsb.h,this.hsb.s,this.hsb.b);this.rgb={r:t.r,g:t.g,b:t.b}},setBrightness:function(t){100<t?t=100:t<0&&(t=0),this.hsb.b=t;t=this.HSBAtoRGBA(this.hsb.h,this.hsb.s,this.hsb.b);this.rgb={r:t.r,g:t.g,b:t.b}},setAlpha:function(t){1<(t=parseInt(100*t,10)/100)?t=1:t<0&&(t=0),this.alpha=t},toRGBA:function(){return{r:this.rgb.r,g:this.rgb.g,b:this.rgb.b,a:this.alpha}},toHSBA:function(){return{h:this.hsb.h,s:this.hsb.s,b:this.hsb.b,a:this.alpha}},toHex:function(){return"#"+(1<<24|parseInt(this.rgb.r,10)<<16|parseInt(this.rgb.g,10)<<8|parseInt(this.rgb.b,10)).toString(16).substr(1)}},t.prototype={defaults:{onSelect:null},_init:function(t){this.config=v.extend(!0,{},this.defaults,t),this._create()},_create:function(){this._buildDOM(),this._bind(),this._refresh()},_buildDOM:function(){var t=v("<div></div>").addClass("vision-data"),e=v("<div></div>").addClass("vision-color-picker"),n=v("<div></div>").addClass("vision-thumb"),i=v("<div></div>").addClass("vision-pallete").append(n),o=v("<div></div>").addClass("vision-thumb"),a=v("<div></div>").addClass("vision-hue").append(o),r=v("<div></div>").addClass("vision-panel"),s=v("<div></div>").addClass("vision-input").append('<span>R<input type="text" maxlength="3" size="3"/><span class="vision-thumb"></span></span>'),l=v("<div></div>").addClass("vision-input").append('<span>G<input type="text" maxlength="3" size="3"/><span class="vision-thumb"></span></span>'),c=v("<div></div>").addClass("vision-input").append('<span>B<input type="text" maxlength="3" size="3"/><span class="vision-thumb"></span></span>'),u=v("<div></div>").addClass("vision-line"),p=v("<div></div>").addClass("vision-input").append('<span>H<input type="text" maxlength="3" size="3"/><span class="vision-thumb"></span></span>'),h=v("<div></div>").addClass("vision-input").append('<span>S<input type="text" maxlength="3" size="3"/><span class="vision-thumb"></span></span>'),d=v("<div></div>").addClass("vision-input").append('<span>B<input type="text" maxlength="3" size="3"/><span class="vision-thumb"></span></span>');r.append(s,l,c,u,p,h,d),e.append(t.append(i,a,r)),this.controls.$picker=e,this.controls.$pallete=i,this.controls.$pallete_thumb=n,this.controls.$hue=a,this.controls.$hue_thumb=o,this.controls.$input_rgb_r=s.find("input"),this.controls.$input_rgb_g=l.find("input"),this.controls.$input_rgb_b=c.find("input"),this.controls.$input_hsb_h=p.find("input"),this.controls.$input_hsb_s=h.find("input"),this.controls.$input_hsb_b=d.find("input"),this.controls.$input_rgb_r_thumb=s.find(".vision-thumb"),this.controls.$input_rgb_g_thumb=l.find(".vision-thumb"),this.controls.$input_rgb_b_thumb=c.find(".vision-thumb"),this.controls.$input_hsb_h_thumb=p.find(".vision-thumb"),this.controls.$input_hsb_s_thumb=h.find(".vision-thumb"),this.controls.$input_hsb_b_thumb=d.find(".vision-thumb");t=v("<div></div>").addClass("vision-data"),c=v("<div></div>").addClass("vision-thumb"),p=v("<div></div>").addClass("vision-gradient"),h=v("<div></div>").addClass("vision-alpha").append(p,c),r=v("<div></div>").addClass("vision-panel"),d=v("<div></div>").addClass("vision-input").append('<span>A<input type="text" maxlength="3" size="3"/><span class="vision-thumb"></span></span>');r.append(d),e.append(t.append(h,r)),this.controls.$alpha=h,this.controls.$alpha_thumb=c,this.controls.$alpha_gradient=p,this.controls.$input_alpha=d.find("input"),this.controls.$input_alpha_thumb=d.find(".vision-thumb");t=v("<div></div>").addClass("vision-data"),c=v("<div></div>").addClass("vision-preview").append("<div><div></div></div>"),p=v("<input readonly />").addClass("vision-input-color"),d=v("<div></div>").addClass("vision-submit").text("OK");e.append(t.append(c,p,d)),this.controls.$preview=c.find("> div > div"),this.controls.$input_color=p,this.controls.$submit=d,e.appendTo("body")},_bind:function(){this.controls.$pallete.on("mousedown",v.proxy(this._onPalleteEditStart,this)),this.controls.$pallete.on("click",v.proxy(this._onPalleteEditMove,this)),this.controls.$hue.on("mousedown",v.proxy(this._onHueEditStart,this)),this.controls.$hue.on("click",v.proxy(this._onHueEditMove,this)),this.controls.$alpha.on("mousedown",v.proxy(this._onAlphaEditStart,this)),this.controls.$alpha.on("click",v.proxy(this._onAlphaEditMove,this)),this.controls.$input_rgb_r_thumb.on("mousedown",v.proxy(this._onInputEditStart,this,"rgb_r")),this.controls.$input_rgb_g_thumb.on("mousedown",v.proxy(this._onInputEditStart,this,"rgb_g")),this.controls.$input_rgb_b_thumb.on("mousedown",v.proxy(this._onInputEditStart,this,"rgb_b")),this.controls.$input_hsb_h_thumb.on("mousedown",v.proxy(this._onInputEditStart,this,"hsb_h")),this.controls.$input_hsb_s_thumb.on("mousedown",v.proxy(this._onInputEditStart,this,"hsb_s")),this.controls.$input_hsb_b_thumb.on("mousedown",v.proxy(this._onInputEditStart,this,"hsb_b")),this.controls.$input_alpha_thumb.on("mousedown",v.proxy(this._onInputEditStart,this,"alpha")),this.controls.$input_rgb_r.on("input",v.proxy(this._onInput,this,"rgb_r")),this.controls.$input_rgb_g.on("input",v.proxy(this._onInput,this,"rgb_g")),this.controls.$input_rgb_b.on("input",v.proxy(this._onInput,this,"rgb_b")),this.controls.$input_hsb_h.on("input",v.proxy(this._onInput,this,"hsb_h")),this.controls.$input_hsb_s.on("input",v.proxy(this._onInput,this,"hsb_s")),this.controls.$input_hsb_b.on("input",v.proxy(this._onInput,this,"hsb_b")),this.controls.$input_alpha.on("input",v.proxy(this._onInput,this,"alpha")),this.controls.$submit.on("click",v.proxy(this._onSubmit,this))},_refresh:function(){var t=this.color.toRGBA(),e=this.color.toHSBA(),n=this.controls.$pallete.outerHeight()-2,i=this.controls.$pallete.outerWidth()-2;this.controls.$pallete.css({"background-color":"hsl("+e.h+", 100%, 50%)"}),this.controls.$pallete_thumb.css({top:parseInt(n-n*e.b/100,10)}),this.controls.$pallete_thumb.css({left:parseInt(i-i*(100-e.s)/100,10)});n=this.controls.$hue.outerHeight()-2;this.controls.$hue_thumb.css({top:parseInt(n-n*e.h/360,10)});i=this.controls.$alpha.outerWidth()-2;this.controls.$alpha_thumb.css({left:parseInt(i-i*(1-e.a),10)}),this.controls.$alpha_gradient.css({background:"linear-gradient(to left,"+this.color.hex()+",rgba(0,0,0,0))"}),this.controls.$input_rgb_r.val(t.r),this.controls.$input_rgb_g.val(t.g),this.controls.$input_rgb_b.val(t.b),this.controls.$input_hsb_h.val(e.h),this.controls.$input_hsb_s.val(e.s),this.controls.$input_hsb_b.val(e.b),this.controls.$input_alpha.val(parseInt(100*t.a,10)),this.controls.$preview.css({"background-color":this.color.rgba()}),this.controls.$input_color.val(1!=t.a?this.color.rgba():this.color.hex())},_show:function(t){var e=t.offset(),n=t.outerWidth(),i=t.outerHeight(),o=this.controls.$picker.outerWidth(),a=this.controls.$picker.outerHeight(),r=e.top-a-1,t=e.left;this.controls.$picker.offset({top:r,left:t});a=this.controls.$picker.get(0).getBoundingClientRect();a.y<0&&(r=e.top+i+offsetH+1,this.controls.$picker.offset({top:r})),a.x+a.width>window.innerWidth&&(t=e.left+n-o,this.controls.$picker.offset({left:t})),this.controls.$picker.addClass("vision-active"),v("body").on("mousedown touchstart",v.proxy(this._onBodyClick,this))},_hide:function(){this.controls.$picker.removeClass("vision-active").css({top:"",left:""}),v("body").off("mousedown touchstart",v.proxy(this._onBodyClick,this))},_destroy:function(){this.controls.$picker&&this.controls.$picker.remove(),this.config=null,this.color=new c,this.controls={}},_onPalleteEditStart:function(t){v("body").on("mouseup",v.proxy(this._onPalleteEditEnd,this)),v("body").on("mousemove",v.proxy(this._onPalleteEditMove,this))},_onPalleteEditMove:function(t){var e=this.controls.$pallete.outerHeight(),n=this.controls.$pallete.outerWidth(),n=100-parseInt(100*(n-Math.max(0,Math.min(n,t.pageX-this.controls.$pallete.offset().left)))/n,10),e=parseInt(100*(e-Math.max(0,Math.min(e,t.pageY-this.controls.$pallete.offset().top)))/e,10);return this.color.setSaturation(n),this.color.setBrightness(e),this._refresh(),!1},_onPalleteEditEnd:function(t){return v("body").off("mouseup",v.proxy(this._onPalleteEditEnd,this)),v("body").off("mousemove",v.proxy(this._onPalleteEditMove,this)),this._refresh(),!1},_onHueEditStart:function(t){v("body").on("mouseup",v.proxy(this._onHueEditEnd,this)),v("body").on("mousemove",v.proxy(this._onHueEditMove,this))},_onHueEditMove:function(t){var e=this.controls.$hue.outerHeight(),e=parseInt(360*(e-Math.max(0,Math.min(e,t.pageY-this.controls.$hue.offset().top)))/e,10);return this.color.setHue(e),this._refresh(),!1},_onHueEditEnd:function(t){return v("body").off("mouseup",v.proxy(this._onHueEditEnd,this)),v("body").off("mousemove",v.proxy(this._onHueEditMove,this)),this._refresh(),!1},_onAlphaEditStart:function(t){v("body").on("mouseup",v.proxy(this._onAlphaEditEnd,this)),v("body").on("mousemove",v.proxy(this._onAlphaEditMove,this))},_onAlphaEditMove:function(t){var e=this.controls.$alpha.outerWidth(),e=1-(e-Math.max(0,Math.min(e,t.pageX-this.controls.$alpha.offset().left)))/e;return this.color.setAlpha(e),this._refresh(),!1},_onAlphaEditEnd:function(t){return v("body").off("mouseup",v.proxy(this._onAlphaEditEnd,this)),v("body").off("mousemove",v.proxy(this._onAlphaEditMove,this)),this._refresh(),!1},_onInputEditStart:function(t,e){v("body").on("mouseup",v.proxy(this._onInputEditEnd,this)),v("body").on("mousemove",v.proxy(this._onInputEditMove,this)),this.inputEdit.enabled=!0,this.inputEdit.pageY=e.pageY,this.inputEdit.value=parseInt(v(e.target).siblings("input").val(),10),this.inputEdit.type=t},_onInputEditMove:function(t){if(this.inputEdit.enabled){var t=t.pageY-this.inputEdit.pageY,e=this.inputEdit.value+t;switch(this.inputEdit.type){case"rgb_r":this.color.setRed(e);break;case"rgb_g":this.color.setGreen(e);break;case"rgb_b":this.color.setBlue(e);break;case"hsb_h":this.color.setHue(e);break;case"hsb_s":this.color.setSaturation(e);break;case"hsb_b":this.color.setBrightness(e);break;case"alpha":this.color.setAlpha(e/100)}}return this._refresh(),!1},_onInputEditEnd:function(t){return v("body").off("mouseup",v.proxy(this._onInputEditEnd,this)),v("body").off("mousemove",v.proxy(this._onInputEditMove,this)),this.inputEdit.enabled=!1,this.inputEdit.pageY=0,this.inputEdit.value=0,this.inputEdit.type=null,this._refresh(),!1},_onInput:function(t,e){var n=v(e.target).val(),n=parseInt(n,10)||0;switch(t){case"rgb_r":this.color.setRed(n);break;case"rgb_g":this.color.setGreen(n);break;case"rgb_b":this.color.setBlue(n);break;case"hsb_h":this.color.setHue(n);break;case"hsb_s":this.color.setSaturation(n);break;case"hsb_b":this.color.setBrightness(n);break;case"alpha":this.color.setAlpha(n/100)}return this._refresh(),!1},_onSubmit:function(t){this._hide(),"function"==typeof this.config.onSelect&&this.config.onSelect.call(this,this.color)},_onBodyClick:function(t){0!==this.controls.$picker.has(t.target).length||v(t.target).hasClass("vision-color-picker")||this._hide()},show:function(t,e){e&&(this.color.setColor(e),this._refresh()),this._show(t)},hide:function(){this._hide()},destroy:function(){this._destroy()}};var u=new t({onSelect:function(t){t=1==t.alpha?t.hex():t.rgba();a.setValue(o,t),a.scan(),p(),s.val(t)}});function p(){var t=n.data("callback");t&&a.changeDetector.compile(t)(e)}a.changeDetector.watch("$destroy",function(){u.destroy()}),a.watch(o,function(t){var e;v(i).removeClass("vision-invalid"),null==t?(s.val(null),r.find("> div > div").css({"background-color":""})):((e=new c).setColor(t)?r.find("> div > div").css({"background-color":e.rgba()}):r.find("> div > div").css({"background-color":""}),s.val(t))},{readOnly:!0})}},t.directives.al.tooltipplacement={restrict:"EA",link:function(t,e,n,i){var e=v(e),o=v("<select/>").addClass(e.get(0).className);o.append('<option value="none">none</option>'),o.append('<option value="top">top</option>'),o.append('<option value="right">right</option>'),o.append('<option value="bottom">bottom</option>'),o.append('<option value="left">left</option>'),o.append('<option value="top-left">top-left</option>'),o.append('<option value="top-right">top-right</option>'),o.append('<option value="right-top">right-top</option>'),o.append('<option value="right-bottom">right-bottom</option>'),o.append('<option value="bottom-left">bottom-left</option>'),o.append('<option value="bottom-right">bottom-right</option>'),o.append('<option value="left-top">left-top</option>'),o.append('<option value="left-bottom">left-bottom</option>'),e.append(o),o.unwrap(),o.on("change",function(t){var e=o.val();"none"==e&&(e=null);i.setValue(n,e),i.scan()}),i.watch(n,function(t){null==t?o.val("none"):o.val(t)},{readOnly:!0})}},t.directives.al.tooltiptrigger={restrict:"EA",link:function(t,e,n,i){var e=v(e),o=v("<select/>").addClass(e.get(0).className);o.append('<option value="none">none</option>'),o.append('<option value="hover">hover</option>'),o.append('<option value="focus">focus</option>'),o.append('<option value="click">click</option>'),o.append('<option value="clickbody">click & body</option>'),o.append('<option value="sticky">sticky</option>'),e.append(o),o.unwrap(),o.on("change",function(t){var e=o.val();"none"==e&&(e=null);i.setValue(n,e),i.scan()}),i.watch(n,function(t){null==t?o.val("none"):o.val(t)},{readOnly:!0})}},t.directives.al.popovertype={restrict:"EA",link:function(t,e,n,i){var e=v(e),o=v("<select/>").addClass(e.get(0).className);o.append('<option value="tooltip">tooltip</option>'),o.append('<option value="inbox">inbox</option>'),o.append('<option value="lightbox">lightbox</option>'),e.append(o),o.unwrap(),o.on("change",function(t){var e=o.val();"default"==e&&(e=null);i.setValue(n,e),i.scan()}),i.watch(n,function(t){null==t?o.val("default"):o.val(t)},{readOnly:!0})}},t.directives.al.popoverplacement={restrict:"EA",link:function(t,e,n,i){var e=v(e),o=v("<select/>").addClass(e.get(0).className);o.append('<option value="none">none</option>'),o.append('<option value="top-left">top-left</option>'),o.append('<option value="top">top</option>'),o.append('<option value="top-right">top-right</option>'),o.append('<option value="right-top">right-top</option>'),o.append('<option value="right">right</option>'),o.append('<option value="right-bottom">right-bottom</option>'),o.append('<option value="bottom-right">bottom-right</option>'),o.append('<option value="bottom">bottom</option>'),o.append('<option value="bottom-left">bottom-left</option>'),o.append('<option value="left-bottom">left-bottom</option>'),o.append('<option value="left">left</option>'),o.append('<option value="left-top">left-top</option>'),e.append(o),o.unwrap(),o.on("change",function(t){var e=o.val();"none"==e&&(e=null);i.setValue(n,e),i.scan()}),i.watch(n,function(t){null==t?o.val("none"):o.val(t)},{readOnly:!0})}},t.directives.al.popovertrigger={restrict:"EA",link:function(t,e,n,i){var e=v(e),o=v("<select/>").addClass(e.get(0).className);o.append('<option value="none">none</option>'),o.append('<option value="hover">hover</option>'),o.append('<option value="focus">focus</option>'),o.append('<option value="click">click</option>'),o.append('<option value="dblclick">dblclick</option>'),e.append(o),o.unwrap(),o.on("change",function(t){var e=o.val();"none"==e&&(e=null);i.setValue(n,e),i.scan()}),i.watch(n,function(t){null==t?o.val("none"):o.val(t)},{readOnly:!0})}},i.config=v.extend(!0,{},i.defaultConfig),i.alight=t,i.rootScope=i.alight(document.querySelectorAll("#vision-app-item")[0],{appData:i}),i.fn.init(i)}}function p(){var e={alight:null,rootScope:null,wp_ajax_url:null,wp_ajax_nonce:null,wp_ajax_action_update:null,wp_ajax_action_get:null,wp_ajax_action_delete_data:null,wp_ajax_action_modal:null,wp_ajax_msg_error:null,themes:null,roles:null,config:null,defaultConfig:{themeJavaScript:null,themeCSS:null,roles:null},fn:{init:function(t){v("#vision-app-settings").removeAttr("style"),t.plan=vision_globals.plan,t.wp_ajax_url=vision_globals.ajax_url,t.wp_ajax_nonce=vision_globals.ajax_nonce,t.wp_ajax_action_update=vision_globals.ajax_action_update,t.wp_ajax_action_get=vision_globals.ajax_action_get,t.wp_ajax_action_delete_data=vision_globals.ajax_action_delete_data,t.wp_ajax_action_modal=vision_globals.ajax_action_modal,t.wp_ajax_msg_error=vision_globals.ajax_msg_error,t.fn.initConfig(t)},enableLoading:function(t){v("#vision-app-settings").removeClass("vision-active")},disableLoading:function(t){setTimeout(function(){v("#vision-app-settings").addClass("vision-active")},1e3)},loadData:function(i,t){var o=v.Deferred();return v.ajax({url:i.wp_ajax_url,type:"POST",dataType:"json",data:{nonce:i.wp_ajax_nonce,action:i.wp_ajax_action_get,type:t},success:function(t){t&&t.success?o.resolve(t.data):this.error()},error:function(t,e,n){i.fn.showNotice(i,i.wp_ajax_msg_error,"notice-error"),o.reject()}}),o.promise()},initConfig:function(e){e.fn.enableLoading(e);var t=v.extend(!0,{},e.defaultConfig,vision_globals.config?JSON.parse(vision_globals.config):null);if(e.config=t,e.config)for(var n in e.config)e.defaultConfig.hasOwnProperty(n)||delete e.config[n];e.fn.loadData(e,"editor-themes").done(function(t){e.themes=t.list}).always(function(){e.rootScope.scan(),e.fn.disableLoading(e)}),e.fn.loadData(e,"roles").done(function(t){e.roles=t.list}).always(function(){e.rootScope.scan(),e.fn.disableLoading(e)})},saveConfig:function(e){e.fn.enableLoading(e);var t=v.extend(!0,{},e.config),t=JSON.stringify(t);v.ajax({url:e.wp_ajax_url,type:"POST",dataType:"json",data:{nonce:e.wp_ajax_nonce,action:e.wp_ajax_action_update,config:t}}).done(function(t){t?e.fn.showNotice(e,t.data.msg,t.success?"notice-success":"notice-error"):e.fn.showNotice(e,e.wp_ajax_msg_error,"notice-error")}).fail(function(){e.fn.showNotice(e,e.wp_ajax_msg_error,"notice-error")}).always(function(){e.fn.disableLoading(e)})},deleteAllData:function(e,t){var n={text:t};e.modal.fn.show(e,"confirm",n).then(function(t){e.modal.fn.close(e,n.id),"close"!=t&&t&&(e.fn.enableLoading(e),v.ajax({url:e.wp_ajax_url,type:"POST",dataType:"json",data:{nonce:e.wp_ajax_nonce,action:e.wp_ajax_action_delete_data}}).done(function(t){t?e.fn.showNotice(e,t.data.msg,t.success?"notice-success":"notice-error"):e.fn.showNotice(e,e.wp_ajax_msg_error,"notice-error")}).fail(function(){e.fn.showNotice(e,e.wp_ajax_msg_error,"notice-error")}).always(function(){e.fn.disableLoading(e)}),e.rootScope.scan())})},showNotice:function(t,e,n){var i=v("#vision-messages"),o=v("<div></div>").addClass("notice is-dismissible").addClass(n),n=v("<p></p>").html(e),e=v("<button></button>").attr("type","button").addClass("notice-dismiss").html('<span class="screen-reader-text">Dismiss this notice.</span>');function a(){clearTimeout(o.data("timer")),o.fadeTo(100,0,function(){o.slideUp(100,function(){o.remove()})})}o.data("timer",setTimeout(a,5e3)),e.click(function(t){t.preventDefault(),a()}),o.append(n,e),i.append(o)}},modal:{count:0,items:[],fn:{resize:function(t){var e=v("#vision-modal-"+t.id),n=(e.find(".vision-modal-dialog"),e.find(".vision-modal-header")),t=e.find(".vision-modal-data"),e=e.find(".vision-modal-footer"),n=n.outerHeight()+e.outerHeight()+50,e=v(window).height();e-n<t.height()&&t.outerHeight(e-n)},show:function(i,t,n,e){var o=++i.modal.count,a=v.Deferred();return i.modal.items.push(o),i.inprocess++,v.ajax({url:i.wp_ajax_url,type:"GET",dataType:"html",data:{nonce:i.wp_ajax_nonce,action:i.wp_ajax_action_modal,name:t}}).done(function(t){v("body").addClass("vision-modal-open");var t=v(t),e={};e.modalData=n,e.modalData.id=o,e.modalData.deferred=a,e.modalData.appData=i,null!=n.easyClose&&!n.easyClose||t.on("click",function(t){e.modalData.deferred.resolve("close")}),v("#vision-modals").append(t),t.find(".vision-modal-dialog").on("click",function(t){return!1}),n.rootScope=i.alight(t.get(0),e),i.modal.fn.resize(n)}).fail(function(t,e,n){i.fn.showNotice(i,i.wp_ajax_msg_error,"notice-error")}).always(function(){e&&"function"==typeof e&&e.call(this,n),i.inprocess--}),a.promise()},close:function(t,e){v("#vision-modal-"+e).remove();e=t.modal.items.indexOf(e);t.modal.items.splice(e,1),0==t.modal.items.length&&jQuery("body").removeClass("vision-modal-open")}}}};window.alightInitCallback=function(t){delete window.alightInitCallback,t.directives.al.toggle={restrict:"EA",link:function(e,t,n,i){var o=v(t);o.addClass("vision-toggle").html("&nbsp;"),o.on("mousedown touchstart",function(t){i.setValue(n,!i.getValue(n)),i.scan(),function(){var t=o.data("callback");t&&i.changeDetector.compile(t)(e)}()}),i.watch(n,function(t){t?o.addClass("vision-checked").removeClass("vision-unchecked"):o.removeClass("vision-checked").addClass("vision-unchecked")},{readOnly:!0})}},t.directives.al.checkboxlist={restrict:"EA",link:function(l,t,c,u){var p=v(t),h=v("<ul>"),d=p.data("predefined"),f=p.data("src");p.addClass("vision-checkboxlist").append(h),p.on("click",".vision-checkbox",function(t){for(var e=v(this),n=e.parent().data("id"),i=u.getValue(f),o=0;o<i.length;o++)if(i[o].id==n){var a=u.getValue(c);if(a){for(var r=!0,s=0;s<a.length;s++)if(a[s]==n){r=!1,a.splice(s,1),e.removeClass("vision-checked"),0==a.length&&(a=null);break}r&&(a.push(n),e.addClass("vision-checked"))}else(a=[]).push(n),e.addClass("vision-checked");u.setValue(c,a),u.scan(),function(){var t=p.data("callback");t&&u.changeDetector.compile(t)(l)}();break}}),f&&u.watch(f,function(t){var e=u.getValue(f),n=u.getValue(c);if(h.empty(),e instanceof Array)for(var i=0;i<e.length;i++){var o=v("<li>").attr({"data-id":e[i].id}),a=v("<div>").addClass("vision-checkbox"),r=v("<div>").addClass("vision-name").text(e[i].name);if(d==e[i].id&&a.addClass("vision-checked vision-readonly"),n instanceof Array)for(var s=0;s<n.length;s++)if(n[s]==e[i].id){a.addClass("vision-checked");break}o.append(a,r),h.append(o)}},{readOnly:!0})}},e.config=v.extend(!0,{},e.defaultConfig),e.alight=t,e.rootScope=e.alight(document.querySelectorAll("#vision-app-settings")[0],{appData:e}),e.fn.init(e)}}function h(){var K=function(t,e){return K.bootstrap(t,e)};K.version="0.14.0",K.filters={},K.text={},K.core={},K.utils={},K.option={globalController:!1,removeAttribute:!0,domOptimization:!0,domOptimizationRemoveEmpty:!0,fastBinding:!0},K.debug={scan:0,directive:!1,watch:!1,watchText:!1,parser:!1},K.ctrl=K.controllers={},K.d=K.directives={al:{},bo:{},$global:{}},K.hooks={directive:[],binding:[]},K.priority={al:{app:2e3,checked:20,class:30,css:30,focused:20,if:700,ifnot:700,model:25,radio:25,repeat:1e3,select:20,stop:-10,value:20,on:10},$component:5,$attribute:-5};function k(t,e){0<=(e=t.indexOf(e))?t.splice(e,1):console.warn("trying to remove not exist item")}var t,e,n,i,u,b,o,a,x,T,l,p,w,c,r,_,C,A,j,h,d,L,f,B,M,s,v,m,g,y,$,S,D,E,O,N,I,F,R,H,z,P,V,W,U,X,J,Y,G,q,Z,Q,tt,et,nt,it,ot,at,rt,st,lt,ct=K.f$={};function ut(e,t){var n,i,o,a,r=[],s=!1,l=t.cd,c=t.callback;return t.filterConf.args.length?(i=[],t.filterConf.args.forEach(function(t,e){t=l.watch(t,function(t){r[e+1]=t,a()});t.$.isStatic||i.push(t)}),o=!1,a=function(){o||(o=!0,l.watch("$onScanOnce",function(){var t;o=!1,s&&(t=e.apply(null,r),ct.isPromise(t)?t.then(function(t){c(t),l.scan()}):c(t))}))},i.length&&(n=function(){i.forEach(function(t){return t.stop()})})):a=function(){var t=e(r[0]);ct.isPromise(t)?t.then(function(t){c(t),l.scan()}):c(t)},{onChange:function(t){s=!0,r[0]=t,a()},onStop:n,watchMode:t.watchMode}}function pt(t,e,n,i,o,a){i.callback.apply(null,a);e=e._properties.root;e&&e.topCD&&e.topCD.scan({zone:!0})}function ht(t,e,n,i){i.setValue(i.attrArgument,e)}function dt(t){return t.replace(/(-\w)/g,function(t){return t.substring(1).toUpperCase()})}function ft(t){var e,n=t.listener,i=t.childCD,o=t.name,a=t.parentName,r=t.parentCD,t={},o=dt(o);if(n&&!0!==n)if(lt.isFunction(n))e=n;else{if(e=n.onChange,"copy"===n||"copy"===n.watchMode)return void(e?e(a):i.scope[o]=a);"array"!==n&&"array"!==n.watchMode||(t.isArray=!0),"deep"!==n&&"deep"!==n.watchMode||(t.deep=!0)}r.watch(a,e=e||function(t){i.scope[o]=t,i.scan()},t)}return ct.before=function(t,e){t.parentNode.insertBefore(e,t)},ct.after=function(t,e){var n=t.parentNode,t=t.nextSibling;t?n.insertBefore(e,t):n.appendChild(e)},ct.remove=function(t){var e=t.parentNode;e&&e.removeChild(t)},ct.on=function(t,e,n){t.addEventListener(e,n,!1)},ct.off=function(t,e,n){t.removeEventListener(e,n,!1)},ct.isFunction=function(t){return t&&"[object Function]"===Object.prototype.toString.call(t)},ct.isObject=function(t){return t&&"[object Object]"===Object.prototype.toString.call(t)},ct.isPromise=function(t){return t&&window.Promise&&t instanceof window.Promise},ct.isElement=function(t){return t instanceof HTMLElement},ct.addClass=function(t,e){t.classList?t.classList.add(e):t.className+=" "+e},ct.removeClass=function(t,e){t.classList?t.classList.remove(e):t.className=t.className.replace(new RegExp("(^| )"+e.split(" ").join("|")+"( |$)","gi")," ")},ct.rawAjax=function(t){var e,n=new XMLHttpRequest;for(e in n.open(t.type||"GET",t.url,!0,t.username,t.password),t.headers)n.setRequestHeader(e,t.headers[e]);t.success&&(n.onload=function(){200<=n.status&&n.status<400?t.success(n.responseText):t.error&&t.error()}),t.error&&(n.onerror=t.error),n.send(t.data||null)},ct.ajaxCache={},ct.ajax=function(t){if(t.username||t.password||t.headers||t.data||!t.cache)return ct.rawAjax(t);var e=t.type||"GET",n=e+":"+t.url,i=ct.ajaxCache[n];i||(ct.ajaxCache[n]=i={callback:[]}),i.result?t.success&&t.success(i.result):(i.callback.push(t),i.loading||(i.loading=!0,ct.rawAjax({type:e,url:t.url,success:function(t){i.loading=!1,i.result=t;for(var e=0;e<i.callback.length;e++)i.callback[e].success&&i.callback[e].success(t);i.callback.length=0},error:function(){i.loading=!1;for(var t=0;t<i.callback.length;t++)i.callback[t].error&&i.callback[t].error();i.callback.length=0}})))},t='@charset "UTF-8";[al-cloak],[hidden],.al-hide{display:none !important;}',e=document.querySelectorAll("head")[0],(ot=document.createElement("style")).setAttribute("type","text/css"),ot.styleSheet?ot.styleSheet.cssText=t:ot.appendChild(document.createTextNode(t)),e.appendChild(ot),ct.ready=(i=!(n=[]),ct.on(document,"DOMContentLoaded",function t(){i=!0,ct.off(document,"DOMContentLoaded",t);for(var e=0;e<n.length;e++)n[e]();n.length=0}),function(t){i?t():n.push(t)}),window.jQuery&&(window.jQuery.fn.alight=function(t){var n=[];if(this.each(function(t,e){return n.push(e)}),n.length)return K(n,t)}),K.core.getFilter=function(t,e){e=e.locals[t];if(e&&(ct.isFunction(e)||e.init||e.fn))return e;if(e=K.filters[t])return e;throw"Filter not found: "+t},K.core.buildFilterNode=function(t,e,n,i){if(ct.isFunction(n))return ut(n,{cd:t,filterConf:e,callback:i});if(n.init)return n.init.call(t,t.scope,e.raw,{setValue:i,conf:e,changeDetector:t});if(ct.isFunction(n.fn))return ut(n.fn,{cd:t,filterConf:e,callback:i,watchMode:n.watchMode});throw"Wrong filter: "+e.name},K.ChangeDetector=function(t){var e=new o,t=new u(e,t||{});return e.topCD=t},(o=function(){return this.watchers={any:[],finishBinding:[],finishScan:[],finishScanOnce:[],onScanOnce:[]},this.status=null,this.extraLoop=!1,this.finishBinding_lock=!1,this.lateScan=!1,this.topCD=null,this}).prototype.destroy=function(){if(this.watchers.any.length=0,this.watchers.finishBinding.length=0,this.watchers.finishScan.length=0,this.watchers.finishScanOnce.length=0,this.watchers.onScanOnce.length=0,this.topCD)return this.topCD.destroy()},(u=function(t,e){this.scope=e,this.locals=e,this.root=t,this.watchList=[],this.destroy_callbacks=[],this.parent=null,this.children=[],this.rwatchers={any:[],finishScan:[],elEvents:[]}}).prototype.new=function(t,e){var n,i;return e=e||{},i=this,null==t&&(t=i.scope),(n=new u(i.root,t)).parent=i,t===i.scope&&(e.locals?((e=i._ChildLocals)||(i._ChildLocals=e=function(){return this.$$root=t,this},e.prototype=i.locals),n.locals=new e):n.locals=i.locals),i.children.push(n),n},u.prototype.destroy=function(){var t,e,n,i,o,a,r,s,l,c,u,p,h,d,f,v,m,g,y,b,x,w=this,_=w.root;for(w.scope=null,w.parent&&k(w.parent.children,w),n=0,a=(f=w.destroy_callbacks).length;n<a;n++)(0,f[n])();for(i=0,r=(v=w.children.slice()).length;i<r;i++)v[i].destroy();for(o=w.destroy_callbacks.length=0,s=(m=w.watchList).length;o<s;o++)(t=m[o]).onStop&&t.onStop();for(p=w.watchList.length=0,l=(g=w.rwatchers.any).length;p<l;p++)x=g[p],k(_.watchers.any,x);for(h=w.rwatchers.any.length=0,c=(y=w.rwatchers.finishScan).length;h<c;h++)x=y[h],k(_.watchers.finishScan,x);for(d=w.rwatchers.finishScan.length=0,u=(b=this.rwatchers.elEvents).length;d<u;d++)e=b[d],ct.off(e[0],e[1],e[2]);this.rwatchers.elEvents.length=0,_.topCD===w&&(_.topCD=null,_.destroy())},a=function(t){return this.cb=t},r=function(t,e,n){var i=t.root,o=new a(n);return t.rwatchers[e].push(o),i.watchers[e].push(o),{stop:function(){return k(t.rwatchers[e],o),k(i.watchers[e],o)}}},u.prototype.on=function(t,e,n){return ct.on(t,e,n),this.rwatchers.elEvents.push([t,e,n])},p={$any:function(t,e){return r(t,"any",e)},$finishScan:function(t,e){return r(t,"finishScan",e)},$finishScanOnce:function(t,e){t.root.watchers.finishScanOnce.push(e)},$onScanOnce:function(t,e){t.root.watchers.onScanOnce.push(e)},$destroy:function(t,e){t.destroy_callbacks.push(e)},$finishBinding:function(t,e){t.root.watchers.finishBinding.push(e)}},_=function(){},u.prototype.watch=function(e,n,t){var i,o,a,r,s,l,c,u=p[e];if(u)return u(this,n);if((t=!0===(t=t||{})?{isArray:!0}:t).init&&console.warn("watch.init is depricated"),(i=this).root,c=i.scope,ct.isFunction(e)?(a=e,s=K.utils.getId(),r=!0):(r=!1,a=null,"::"===(e=e.trim()).slice(0,2)&&(e=e.slice(2),t.oneTime=!0),s=e,s=t.deep?"d#"+s:t.isArray?"a#"+s:"v#"+s),K.debug.watch&&console.log("$watch",e),s=!1,!r)if(t.watchText)a=t.watchText.fn;else{if((r=K.utils.compile.expression(e)).filter)return function(e,t,n,i){var o,a=null,r=i.oneTime;i.isArray?a="array":i.deep&&(a="deep"),n||(o={el:i.element,ea:i.elementAttr},n=function(t){T(e.scope,o,t)});for(var s=K.utils.parsFilter(t.filter),l=[],c=s.result.length-1;0<=c;c--){var u=K.core.getFilter(s.result[c].name,e),u=K.core.buildFilterNode(e,s.result[c],u,n);u.watchMode&&(a=u.watchMode),u.onStop&&l.push(u.onStop),n=u.onChange}return i={oneTime:r},"array"===a?i.isArray=!0:"deep"===a&&(i.deep=!0),l.length&&(i.onStop=function(){l.forEach(function(t){return t()}),l.length=0}),e.watch(t.expression,n,i)}(i,r,n,t);s=r.isSimple&&0===r.simpleVariables.length,a=r.fn}return t.deep&&(t.isArray=!1),o={isStatic:s,isArray:Boolean(t.isArray),extraLoop:!t.readOnly,deep:!0===t.deep?10:t.deep,value:_,callback:n,exp:a,src:""+e,onStop:t.onStop||null,el:t.element||null,ea:t.elementAttr||null},s?i.watch("$onScanOnce",function(){return T(c,o,o.exp(c))}):i.watchList.push(o),l={$:o,stop:function(){if(t.onStop)try{t.onStop()}catch(t){K.exceptionHandler(t,"Error in onStop of watcher: "+e,e)}if(!o.isStatic)return k(i.watchList,o)},refresh:function(){var t=o.exp(i.locals);return t&&o.deep?o.value=K.utils.clone(t,o.deep):t&&o.isArray?o.value=t.slice():o.value=t}},t.oneTime&&(o.callback=function(t){if(void 0!==t)return l.stop(),n(t)}),l},u.prototype.watchGroup=function(t,e){var n,i,o,a,r,s=this;if(!e&&ct.isFunction(t)&&(e=t,t=null),r=!1,n=function(){if(!r)return r=!0,s.watch("$onScanOnce",function(){return r=!1,e()})},t)for(i=0,a=t.length;i<a;i++)o=t[i],s.watch(o,n);return n},l=window.performance?function(){return Math.floor(performance.now())}:function(){return(new Date).getTime()},w=function(t,e){var n,i,o,a;if(null===t||null===e)return!0;if((a=typeof t)!=typeof e)return!0;if("object"==a){if(t.length!==e.length)return!0;for(n=i=0,o=t.length;i<o;n=++i)if(t[n]!==e[n])return!0}return!1},T=function(t,e,n){e.el?e.ea?e.el.setAttribute(e.ea,n):e.el.nodeValue=n:e.callback.call(t,n)},x=function(t,e,n,i){e={src:n.src,scope:e.scope,locals:e.locals};return n.el&&(e.element=n.el),K.exceptionHandler(t,(1===i?"$scan, error in callback: ":"$scan, error in expression: ")+n.src,e)},b=function(){},c=function(t,e){t.root;var n,i,o,a,r,s,l,c,u,p,h,d,f,v,m=!1,g=0,y=0;if(t){for(h=[],r=0,o=t;o;){for(u=o.locals,y+=o.watchList.length,s=0,c=(d=o.watchList.slice()).length;s<c;s++){l=(v=d[s]).value;try{f=v.exp(u)}catch(t){a=t,f=b}if(l!==f){if(p=!1,v.isArray?(n=Array.isArray(l))===(i=Array.isArray(f))?n?w(l,f)&&(p=!0,v.value=f.slice()):(p=!0,v.value=f):(p=!0,v.value=i?f.slice():f):v.deep?K.utils.equal(l,f,v.deep)||(p=!0,v.value=K.utils.clone(f,v.deep)):(p=!0,v.value=f),p)if(p=!1,f===b)x(a,o,v);else{g++;try{v.el?v.ea?null!=f?v.el.setAttribute(v.ea,f):v.el.removeAttribute(v.ea):v.el.nodeValue=f:(l===_&&(l=void 0),"$scanNoChanges"!==v.callback.call(o.scope,f,l)&&v.extraLoop&&(m=!0))}catch(t){x(a=t,o,v,1)}}1<K.debug.scan&&console.log("changed:",v.src)}}h.push.apply(h,o.children),o=h[r++]}e.total=y,e.changes=g,e.extraLoop=m}},u.prototype.digest=function(){var t,e,n,i,o,a=this.root,r=10,s=0;for(K.debug.scan&&(o=l()),i={total:0,changes:0,extraLoop:!1,src:"",scope:null,element:null};r;){if(r--,a.extraLoop=!1,a.watchers.onScanOnce.length)for(n=a.watchers.onScanOnce.slice(),t=a.watchers.onScanOnce.length=0,e=n.length;t<e;t++)n[t].call(a);if(c(this,i),s+=i.changes,!i.extraLoop&&!a.extraLoop&&!a.watchers.onScanOnce.length)break}return K.debug.scan&&(o=l()-o,console.log("$scan: loops: ("+(10-r)+"), last-loop changes: "+i.changes+", watches: "+i.total+" / "+o+"ms")),i.mainLoop=r,i.totalChanges=s,i},u.prototype.scan=function(t){var e,n,i,o,a,r,s,l,c,u=this.root;if(t=t||{},!K.option.zone||t.zone){if((t=ct.isFunction(t)?{callback:t}:t).callback&&u.watchers.finishScanOnce.push(t.callback),t.late)return u.lateScan?void 0:(u.lateScan=!0,void K.nextTick(function(){if(u.lateScan)return u.topCD.scan()}));if("scaning"!==u.status){if(u.lateScan=!1,u.status="scaning",(t=u.topCD?u.topCD.digest():{}).totalChanges)for(n=0,a=(l=u.watchers.any).length;n<a;n++)(0,l[n])();for(u.status=null,i=0,r=(c=u.watchers.finishScan).length;i<r;i++)(0,c[i])();for(e=u.watchers.finishScanOnce.slice(),o=u.watchers.finishScanOnce.length=0,s=e.length;o<s;o++)e[o].call(u);if(0===t.mainLoop)throw"Infinity loop detected";return t}u.extraLoop=!0}},(K.core.ChangeDetector=u).prototype.compile=function(t,e){return K.utils.compile.expression(t,e).fn},u.prototype.setValue=function(e,n){var i,o,a,r,s,l,c,u,p=this.compile(e+" = $value",{input:["$value"],no_return:!0});try{return p(this.locals,n)}catch(t){if(i=t,l="can't set variable: "+e,K.debug.parser&&console.warn(l),0<=(""+i).indexOf("TypeError")&&(u=e.match(/^([\w\d\.]+)\.[\w\d]+$/))&&u[1]){for(s=this.locals,o=0,r=(c=u[1].split(".")).length;o<r;o++)void 0===s[a=c[o]]&&(s[a]={}),s=s[a];try{return void p(this.locals,n)}catch(t){}}return K.exceptionHandler(i,l,{name:e,value:n})}},u.prototype.eval=function(t){return this.compile(t)(this.locals)},u.prototype.getValue=function(t){return this.eval(t)},K.text.$base=function(e){var n=e.point,t=e.cd,i=t.scope,o=(i.$ns&&i.$ns.text?i.$ns:K).text[e.name];if(!o)throw"No directive alight.text."+e.name;return o.call(t,(t={changeDetector:t,setter:function(t){if(e.update)return n.value=null===t?"":""+t,e.update()},setterRaw:function(t){if(e.updateRaw)return n.value=null===t?"":""+t,e.updateRaw()},finally:function(t){if(e.finally)return n.value=null===t?"":""+t,n.type="text",e.finally(),e.update=null,e.finally=null}}).setter,e.exp,i,t)},u.prototype.watchText=function(t,e,n){var i,o,a,r,s,l,c,u,p,h,d,f,v,m,g,y,b,x,w,_,k,C,$,S,D,E,A;if(n=n||{},o=this,K.debug.watchText&&console.log("$watchText",t),C=K.utils.compile.buildSimpleText(t,null))o.watch(t,e,{watchText:C,element:n.element,elementAttr:n.elementAttr});else{for(r=K.utils.parsText(t),_=!(i=!(E=0)),l=c=s=function(){},f=0,g=r.length;f<g;f++)if("expression"===(a=r[f]).type)if(x=(u=a.list.join("|")).match(/^([^\w\d\s\$"'\(\u0410-\u044F\u0401\u0451]+)/))a.isDir=!0,w=x[1],u="#"===w?(d=u.indexOf(" "))<0?(w=u.substring(1),""):(w=u.slice(1,d),u.slice(d)):u.substring(w.length),K.text.$base({name:w,exp:u,cd:o,point:a,update:function(){return l()},updateRaw:function(){return c()},finally:function(){return l(),s()}}),_=!0,"text"!==a.type&&(i=!1);else if((w=K.utils.compile.expression(u,{string:!0})).filter)E++,a.watched=!(i=!1),function(e){o.watch(u,function(t){return e.value=t=null==t?"":t,l()})}(a);else{if(a.fn=w.fn,!w.rawExpression)throw"Error";w.isSimple&&0===w.simpleVariables.length?(a.type="text",a.value=a.fn()):(a.re=w.rawExpression,E++)}if(i){if(E)return C=_?K.utils.compile.buildSimpleText(null,r):K.utils.compile.buildSimpleText(t,r),void o.watch(t,e,{watchText:{fn:C.fn},element:n.element,elementAttr:n.elementAttr});for(S="",v=0,y=r.length;v<y;v++)a=r[v],S+=a.value;o.watch("$onScanOnce",function(){return T(o.scope,{callback:e,el:n.element,ea:n.elementAttr},S)})}else if(A={callback:e,el:n.element,ea:n.elementAttr},r.scope=o.scope,h=K.utils.compile.buildText(t,r),c=function(){return T(o.scope,A,h())},E){for(D=null,k="",l=function(){k=h()},s=function(){var t,e;for(d=!0,t=0,e=r.length;t<e;t++)if("expression"===(a=r[t]).type){d=!1;break}d&&(o.watch("$finishScanOnce",function(){return D.stop()}),n.onStatic&&n.onStatic())},t=function(){return k},m=0,b=r.length;m<b;m++)"expression"===(a=r[m]).type&&(a.isDir||a.watched||(a.watched=!0,function(e,t){o.watch(t,function(t){return e.value=t=null==t?"":t,l()})}(a,a.list.join(" | "))));l(),D=o.watch(t,e,{element:n.element,elementAttr:n.elementAttr})}else $=!1,p=function(){return $=!1,c()},(l=function(){if(!$)return $=!0,o.watch("$onScanOnce",p)})()}},C={TR:1,TD:1,LI:1},K.utils.optmizeElement=function(t,e){var n,i,o,a,r,s,l,c,u,p,h,d,f,v,m,g,y,b,x;if(1===t.nodeType){for(e=e||!K.option.domOptimizationRemoveEmpty,"PRE"===t.nodeName&&(e=!0),!(a=t.firstChild)||3!==a.nodeType||a.nodeValue.trim()||e||(ct.remove(a),a=t.firstChild),m=!1;a;)f=a.nextSibling,!m||3!==a.nodeType||a.nodeValue.trim()||e?(m=1===a.nodeType&&C[a.nodeName],K.utils.optmizeElement(a,e)):ct.remove(a),a=f;!(a=t.lastChild)||3!==a.nodeType||a.nodeValue.trim()||e||ct.remove(a)}else if(3===t.nodeType&&(b=t.data,h=K.utils.pars_start_tag,!((s=b.indexOf(h))<0||b.slice(s+h.length).indexOf(h)<0))){for(v="t",y=[n={value:""}],l=0,u=(o=K.utils.parsText(b)).length;l<u;l++)"text"===(i=o[l]).type?n.value+=i.value:(r=i.list.join("|"),x=K.utils.pars_start_tag+r+K.utils.pars_finish_tag,r.match(/^([^\w\d\s\$"'\(\u0410-\u044F\u0401\u0451]+)/)?("t"===v||"d"===v?n.value+=x:y.push(n={value:x}),v="d"):1===i.list.length?("t"===v||"v"===v?n.value+=x:y.push(n={value:x}),v="v"):"t"===v?n.value+=x:y.push(n={value:x}));if(!(y.length<2))for((a=t).data=y[0].value,c=0,p=(g=y.slice(1)).length;c<p;c++)i=g[c],d=document.createTextNode(i.value),ct.after(a,d),a=d}},K.hooks.attribute=ot=[],ot.push({code:"dataPrefix",fn:function(){"data-"===this.attrName.slice(0,5)&&(this.attrName=this.attrName.slice(5))}}),ot.push({code:"colonNameSpace",fn:function(){var t,e;this.directive||this.name||((e=(t=(e=this.attrName.match(/^(\w+)[\-\:](.+)$/))?(this.ns=e[1],e[2]):(this.ns="$global",this.attrName)).match(/^([^\.]+)\.(.*)$/))&&(t=e[1],this.attrArgument=e[2]),this.name=t.replace(/(-\w)/g,function(t){return t.substring(1).toUpperCase()}))}}),ot.push({code:"getGlobalDirective",fn:function(){var t;if(!this.directive){if(!(t=K.d[this.ns]))return this.result="noNS",void(this.stop=!0);this.directive=t[this.name],this.directive||("$global"===this.ns?this.result="noNS":this.result="noDirective",this.stop=!0)}}}),ot.push({code:"cloneDirective",fn:function(){var t,e,n=this.directive,i=this.ns,o=this.name,a={};if(ct.isFunction(n))a.init=n;else{if(!ct.isObject(n))throw"Wrong directive: "+i+"."+o;for(t in n)e=n[t],a[t]=e}if(a.priority=n.priority||K.priority[i]&&K.priority[i][o]||0,a.restrict=n.restrict||"A",a.restrict.indexOf(this.attrType)<0)throw"Directive has wrong binding (attribute/element): "+o;this.directive=a}}),ot.push({code:"preprocessor",fn:function(){var r=this.ns,s=this.name,l=this.directive;l.$init=function(t,e,n,i){var o=function(){for(var t,e=a.procLine,n=t=0,i=e.length;t<i;n=++t)if(e[n].fn.call(a),a.isDeferred){a.procLine=e.slice(n+1);break}return a.async=!0,null},a={element:e,value:n,cd:t,env:i,ns:r,name:s,doBinding:!1,directive:l,isDeferred:!1,procLine:K.hooks.directive,makeDeferred:function(){return a.isDeferred=!0,a.doBinding=!0,a.retStopBinding=!0,a.async=!1,function(){if(a.isDeferred=!1,a.async)return o()}}};if(l.stopBinding&&(i.stopBinding=!0),o(),a.retStopBinding)return"stopBinding"}}}),(ot=K.hooks.directive).push({code:"init",fn:function(){var t;this.directive.init&&(K.debug.directive&&this.directive.scope&&console.warn(this.ns+"-"+this.name+" uses scope and init together, probably you need use link instead of init"),this.env.changeDetector=this.cd,(t=this.directive.init.call(this.env,this.cd.scope,this.element,this.value,this.env))&&t.start&&t.start())}}),ot.push({code:"templateUrl",fn:function(){var e,n=this;this.directive.templateUrl&&(e=this.makeDeferred(),ct.ajax({cache:!0,url:this.directive.templateUrl,success:function(t){return n.directive.template=t,e()},error:e}))}}),ot.push({code:"template",fn:function(){var t;this.directive.template&&(1===this.element.nodeType?this.element.innerHTML=this.directive.template:8===this.element.nodeType&&((t=document.createElement("p")).innerHTML=this.directive.template.trim(),t=t.firstChild,ct.after(this.element,t),this.element=t,this.doBinding=!0))}}),ot.push({code:"scope",fn:function(){var t,e;if(this.directive.scope){switch(e=this.cd,this.directive.scope){case!0:t=e.new({$parent:e.scope});break;case"root":t=K.ChangeDetector({$parent:e.scope}),e.watch("$destroy",function(){return t.destroy()});break;default:throw"Wrong scope value: "+this.directive.scope}this.env.parentChangeDetector=e,this.cd=t,this.doBinding=!0,this.retStopBinding=!0}}}),ot.push({code:"link",fn:function(){var t;this.directive.link&&(this.env.changeDetector=this.cd,(t=this.directive.link.call(this.env,this.cd.scope,this.element,this.value,this.env))&&t.start&&t.start())}}),ot.push({code:"scopeBinding",fn:function(){this.doBinding&&!this.env.stopBinding&&K.bind(this.cd,this.element,{skip_attr:this.env.skippedAttr()})}}),s=function(t,e,n){var i;"A"===e.attr_type?((i=n||{}).priority=K.priority.$attribute,i.is_attr=!0,i.name=t,i.attrName=t,i.element=e.element,e.list.push(i)):"M"===e.attr_type&&e.list.push(n)},M=function(t,e){var n,i,o,a;if(0<=e.skip_attr.indexOf(t))return s(t,e,{skip:!0});for(n={attrName:t,attrType:e.attr_type,element:e.element,cd:e.cd,result:null},i=0,o=(a=K.hooks.attribute).length;i<o&&(a[i].fn.call(n),!n.stop);i++);if("noNS"!==n.result)return"noDirective"===n.result?"E"===e.attr_type?void e.list.push({name:t,priority:-10,attrName:t,noDirective:!0}):void s(t,e,{noDirective:!0}):void e.list.push({name:t,directive:n.directive,priority:n.directive.priority,attrName:t,attrArgument:n.attrArgument});s(t,e)},B=function(t,e){return t.priority===e.priority?0:t.priority>e.priority?-1:1},j=function(t,e,n,i){if(!(n.indexOf(K.utils.pars_start_tag)<0))return t.watchText(n,null,{element:e,elementAttr:i}),!0},f=function(t,e,n){var i=e.data;if(!(i.indexOf(K.utils.pars_start_tag)<0))return t.watchText(i,null,{element:e}),i},h=function(e,n,t){var i,o,a,r=n.nodeValue.trim();if("directive:"===r.slice(0,10)){if(a=0<=(o=(r=r.slice(10).trim()).indexOf(" "))?(i=r.slice(0,+(o-1)+1||9e9),r.slice(o+1)):(i=r,""),r={list:o=[],element:n,attr_type:"M",cd:e,skip_attr:[]},M(i,r),(r=o[0]).noDirective)throw"Comment directive not found: "+i;i=r.directive,o=new A({element:n,attrName:r.attrName,attributes:o}),K.debug.directive&&console.log("bind",r.attrName,a,r);try{i.$init(e,n,a,o)}catch(t){K.exceptionHandler(t,"Error in directive: "+r.name,{value:a,env:o,cd:e,scope:e.scope,element:n})}return o.skipToElement?{directive:1,skipToElement:o.skipToElement}:{directive:1,skipToElement:null}}},(A=function(t){var e,n;for(e in t)n=t[e],this[e]=n;return this}).prototype.takeAttr=function(t,e){var n,i,o,a;for(1===arguments.length&&(e=!0),i=0,o=(a=this.attributes).length;i<o;i++)if((n=a[i]).attrName===t)return e&&(n.skip=!0),this.element.getAttribute(t)||!0},A.prototype.skippedAttr=function(){for(var t,e=this.attributes,n=[],i=0,o=e.length;i<o;i++)(t=e[i]).skip&&n.push(t.attrName);return n},A.prototype.scan=function(t){return this.changeDetector.scan(t)},A.prototype.on=function(t,e,n){return this.changeDetector.on(t,e,n)},A.prototype.watch=function(t,e,n){return this.changeDetector.watch(t,e,n)},A.prototype.watchGroup=function(t,e){return this.changeDetector.watchGroup(t,e)},A.prototype.watchText=function(t,e,n){return this.changeDetector.watchText(t,e,n)},A.prototype.getValue=function(t){return this.changeDetector.getValue(t)},A.prototype.setValue=function(t,e){return this.changeDetector.setValue(t,e)},A.prototype.eval=function(t){return this.changeDetector.eval(t)},A.prototype.new=function(t,e){return!0===e?e={locals:!0}:!0===t&&null==e&&(e={locals:!(t=null)}),this.changeDetector.new(t,e)},A.prototype.bind=function(t,e,n){var i,o,a,r,s,l,c;for(this.stopBinding=!0,s=a=0,l=arguments.length;s<l;s++)(i=arguments[s])instanceof u&&(o=i,a+=1),ct.isElement(i)&&(r=i,a+=1);return c=(c=arguments[a])||{skip:this.skippedAttr()},r=r||this.element,o=o||this.changeDetector,K.bind(o,r,c)},d=function(e,o,t){var n,i,a,r,s,l,c,u,p,h,d,f,v,m,g,y,b,x,w,_,k,C,$,S={attr:[],dir:[],children:[]},D={directive:0,hook:0,skipToElement:null,fb:S},E=(t=t||{}).skip_attr;if(!(k=!1)===t.skip?t.skip_top=!0:E=E||(t.skip||[]),E instanceof Array||(E=[E]),!t.skip_top){for(n={list:g=[],element:o,skip_attr:E,attr_type:"E",cd:e},a=o.nodeName.toLowerCase(),M(a,n),"script"!==a&&"style"!==a||(k=!0),n.attr_type="A",d=0,f=(w=o.attributes).length;d<f;d++)i=w[d],M(i.name,n);if(t.attachDirective)for(a in _=t.attachDirective)_[a],M(a,n);for(y=0,v=(g=g.sort(B)).length;y<v;y++)if(!(c=g[y]).skip){if(c.noDirective)throw"Directive not found: "+c.name;if(c.skip=!0,$=t.attachDirective&&t.attachDirective[c.attrName]?t.attachDirective[c.attrName]:o.getAttribute(c.attrName),c.is_attr)j(e,o,$,c.attrName)&&S.attr.push({attrName:c.attrName,value:$});else{p=c.directive,u=new A({element:o,attrName:c.attrName,attrArgument:c.attrArgument||null,attributes:g,stopBinding:!1,elementCanBeRemoved:t.elementCanBeRemoved,fbElement:t.fbElement}),K.debug.directive&&console.log("bind",c.attrName,$,c);try{"stopBinding"===p.$init(e,o,$,u)&&(k=!0)}catch(t){K.exceptionHandler(t,"Error in directive: "+c.attrName,{value:$,env:u,cd:e,scope:e.scope,element:o})}if(u.fastBinding?(p=ct.isFunction(u.fastBinding)?u.fastBinding:p.init,S.dir.push({fb:p,attrName:c.attrName,value:$,attrArgument:u.attrArgument,fbData:u.fbData})):D.directive++,u.stopBinding){k=!0;break}u.skipToElement&&(D.skipToElement=u.skipToElement)}}}if(!k)for(C=null,h=b=0,m=(s=function(){for(var t=o.childNodes,e=[],n=0,i=t.length;n<i;n++)r=t[n],e.push(r);return e}()).length;b<m;h=++b)(r=s[h])&&(C?C===r&&(C=null):(t.fbElement&&(l={fbElement:t.fbElement.childNodes[h]}),x=L(e,r,l),D.directive+=x.directive,D.hook+=x.hook,C=x.skipToElement,x.fb&&(x.fb.text||x.fb.attr&&x.fb.attr.length||x.fb.dir&&x.fb.dir.length||x.fb.children&&x.fb.children.length)&&S.children.push({index:h,fb:x.fb})));return D},L=function(t,e,n){var i,o,a,r,s,l,c={directive:0,hook:0,skipToElement:null,fb:null};if(K.hooks.binding.length)for(o=0,a=(s=K.hooks.binding).length;o<a;o++)if(i=s[o],c.hook+=1,(r=i.fn(t,e,n))&&r.owner)return c;return 1===e.nodeType?(r=d(t,e,n),c.directive+=r.directive,c.hook+=r.hook,c.skipToElement=r.skipToElement,c.fb=r.fb):3===e.nodeType?(l=f(t,e))&&(c.fb={text:l}):8===e.nodeType&&(r=h(t,e))&&(c.directive+=r.directive,c.skipToElement=r.skipToElement),c},K.nextTick=(v=null,m=[],g=function(){var e,t,n,i,o;for(v=null,t=m.slice(),n=m.length=0,i=t.length;n<i;n++){e=(o=t[n])[0],o=o[1];try{e.call(o)}catch(t){K.exceptionHandler(t,"$nextTick, error in function",{fn:e,self:o})}}return null},function(t){if(m.push([t,this]),!v)return v=setTimeout(g,0)}),K.bind=function(t,e,n){var i,o,a,r,s;if(!t)throw"No changeDetector";if(!e)throw"No element";if(n=n||{},K.option.domOptimization&&!n.noDomOptimization&&K.utils.optmizeElement(e),(i=!(s=t.root).finishBinding_lock)&&(s.finishBinding_lock=!0,s.bindingResult={directive:0,hook:0}),n=L(t,e,n),s.bindingResult.directive+=n.directive,s.bindingResult.hook+=n.hook,t.digest(),i){for(s.finishBinding_lock=!1,r=s.watchers.finishBinding.slice(),o=s.watchers.finishBinding.length=0,a=r.length;o<a;o++)(0,r[o])();n.total=s.bindingResult}return n},y=K.bind,K.bind=function(t,e,n){var i=t.root,o=K.option.zone;if(o){var a=!0===o?Zone:o,o=i.zone;if(o||(i.zone=o=a.current.fork({name:a.current.name+".x",properties:{root:i},onInvokeTask:pt})),a.current!==o)return i.zone.run(y,null,[t,e,n])}return y(t,e,n)},K.bootstrap=function(t,e){if(!t)return K.bootstrap("[al-app]"),K.bootstrap("[al\\:app]"),void K.bootstrap("[data-al-app]");var n,i;if(t instanceof K.core.ChangeDetector?(i=t,t=e):e instanceof K.core.ChangeDetector?i=e:ct.isFunction(e)?(i=K.ChangeDetector(n={}),e.call(i,n)):e&&(i=K.ChangeDetector(e)),Array.isArray(t)){for(var o=void 0,a=0,r=t;a<r.length;a++){var s=r[a];o=K.bootstrap(s,i)}return o}if("string"==typeof t){for(var o=void 0,l=0,c=document.querySelectorAll(t);l<c.length;l++){var u=c[l];o=K.bootstrap(u,i)}return o}if(i=i||K.ChangeDetector(),ct.isElement(t)){for(var p,h,d,f=0,v=["al-app","al:app","data-al-app"];f<v.length&&(h=t.getAttribute(p=v[f]),t.removeAttribute(p),!h);f++);return h&&(d={skip_attr:[p],attachDirective:{}},K.d.al.ctrl?d.attachDirective["al-ctrl"]=h:d.attachDirective[h+"!"]=""),K.bind(i,t,d),i}K.exceptionHandler("Error in bootstrap","Error input arguments",{input:t})},K.utils.getId=(D=function(){for(var t,e,n="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".split(""),i=Math.floor((new Date).valueOf()/1e3)-1388512800,o="";0<i;)e=i-62*(t=Math.floor(i/62)),i=t,o=n[e]+o;return o}(),E=1,function(){return D+"#"+E++}),K.utils.clone=$=function(i,o){var a,t,e,n;if((o=null==o?128:o)<1)return null;if(!i)return i;if("object"!=typeof i)return i;if(i instanceof Array)return e=function(){for(var t=[],e=0,n=i.length;e<n;e++)a=i[e],t.push($(a,o-1));return t}();if(i instanceof Date)return new Date(i.valueOf());if(i.nodeType&&"function"==typeof i.cloneNode)return i;for(t in e={},i)n=i[t],"$"!==t[0]&&(e[t]=$(n,o-1));return e},K.utils.equal=S=function(t,e,n){var i,o,a,r,s,l,c;if((n=null==n?128:n)<1)return!0;if(!t||!e)return t===e;if((l=typeof t)!=typeof e)return!1;if("object"!=l)return t===e;if(t instanceof Array){if(t.length!==e.length)return!1;for(i=o=0,r=t.length;o<r;i=++o)if(c=t[i],!S(c,e[i],n-1))return!1;return!0}if(t instanceof Date)return t.valueOf()===e.valueOf();if(t.nodeType&&"function"==typeof t.cloneNode)return t===e;for(a in s={},t)if(c=t[a],"$"!==a[0]&&(s[a]=!0,!S(c,e[a],n-1)))return!1;for(a in e)if(c=e[a],"$"!==a[0]&&!s[a]&&!S(c,t[a],n-1))return!1;return!0},K.exceptionHandler=function(t,e,n){var i=[];return e&&i.push(e),t&&t.message&&i.push(t.message),n&&i.push(n),t&&i.push(t.stack||t),console.error.apply(console,i)},P=(z=function(){for(var t={},e=0,n=arguments.length;e<n;e++)t[arguments[e]]=!0;return t})("instanceof","typeof","in","null","true","false","undefined","return"),R=/[a-zA-Z\u0410-\u044F\u0401\u0451_\.\$]/,N=function(t){return t.match(R)},I=function(t){return 48<=t.charCodeAt()&&t.charCodeAt()<=57},H=z("+","-",">","<","=","&","|","^","!","~"),F=function(t){return H[t]||!1},O=z("=","+=","-=","++","--","|=","^=","&=","!=","<<=",">>="),K.utils.parsExpression=function(t,e){var d,f,c,_,v,u,m=z.apply(null,(e=e||{}).input||[]),k=1,e=(_=function(t){for(var e,n,i,o,a=t.line,r=t.result||[],s=t.index||0,l=t.level||0,c=t.stopKey||null,u="",p=null,h=[],d="",f="",v=!1,m="",g="",y="",b=0,x=null,w=function(){return y&&r.push({type:"free",value:y}),y=""};s<=a.length;)if(i=a[s-1],e=a[s++]||"",n=a[s],(v&&y||!e)&&w(),"string"!==v){if("key"===v){if(N(e)||I(e)){u+=e;continue}if("["===e){if(u+=e,!(o=_({line:a,index:s,level:l+1,stopKey:"]"})).stopKeyOk)throw"Error expression";s=o.index,u+="###"+o.uniq+"###]",h.push(o);continue}if("?"===e&&("."===n||"("===n||"["===n)){u+=e;continue}if("("===e){if(u+=e,!(o=_({line:a,index:s,level:l+1,stopKey:")"})).stopKeyOk)throw"Error expression";s=o.index,u+="###"+o.uniq+"###)",h.push(o);continue}p={type:"key",value:u,start:s-u.length-1,finish:s-1,children:h},r.push(p),u=v="",h=[]}else if("sign"===v){if(F(e)){d+=e;continue}if("|"===d&&0===l&&0===b){x=a.substring(s-1),s=a.length+1;continue}(O[d]||"="===d[0]&&"="!==d[1])&&(p.assignment=!0),r.push({type:"sign",value:d}),d=v=""}else if("digit"===v){if(I(e)||"."===e){f+=e;continue}r.push({type:"digit",value:f}),f=""}if(N(e))v="key",u+=e;else if(F(e))v="sign",d+=e;else if(I(e))v="digit",f+=e;else if('"'!==e&&"'"!==e){if(e===c)return w(),{result:r,index:s,stopKeyOk:!0,uniq:k++};"("===e&&b++,")"===e&&b--,"{"!==e?(":"===e&&"}"===c&&(p.type="free"),y+=e):(w(),o=_({line:a,index:s,level:l+1,stopKey:"}"}),r.push({type:"{}",child:o}),s=o.index)}else v="string",g+=m=e}else e!==m||"\\"===i?g+=e:(r.push({type:"string",value:g+=e}),v=m=g="");return w(),{result:r,index:s,filter:x}})({line:t}),g={isSimple:!e.filter,simpleVariables:[]};return e.filter?(g.expression=t.substring(0,t.length-e.filter.length-1),g.filter=e.filter):g.expression=t,v=function(t){t=t.split(/[\.\[\(\?]/);return{count:t.length,firstPart:t[0]}},u=function(t,e){return e?"($$="+t+",$$==null)?undefined:":"($$=$$"+t+",$$==null)?undefined:"},c=function(t){return t.split(/[\.\[\(\?]/)[0]},f=function(t){var e,n,i,o,a,r,s,l;if("this"===t)return"$$scope";if(r=c(t),i=P[r]||m[r],"this"===r&&(t="$$scope"+t.slice(4),i=!0),1===(r=t.split("?")).length)return i?t:"$$scope."+t;for(e=i?(l=u(r[0],!0),r[0]):(l=u("scope."+r[0]),"scope."+r[0]),n=0,o=(s=r.slice(1,r.length-1)).length;n<o;n++)"("===(a=s[n])[0]?l+=u(e+a,i):(l+=u(a),e+=a);return"("===(r=r[r.length-1])[0]?(i||(l+="$$"),l+=e+r):l+="$$"+r,"("+l+")"},d=function(t){for(var e,n,i,o,a,r,s,l,c="",u=t.result,p=0,h=u.length;p<h;p++)if("key"!==(n=u[p]).type)"{}"!==n.type?c+=n.value:c+="{"+d(n.child)+"}";else{if(n.assignment?(r="this"===(l=v(n.value)).firstPart?"$$scope"+n.value.substring(4):m[l.firstPart]?n.value:l.count<2?"($$scope.$$root || $$scope)."+n.value:"$$scope."+n.value,g.isSimple=!1):P[n.value]?r=n.value:(r=f(n.value),g.simpleVariables.push(r)),n.children.length)for(i=0,a=(s=n.children).length;i<a;i++)o="###"+(e=s[i]).uniq+"###",e=d(e),r=r.split(o).join(e);c+=r}return c},g.result=d(e),K.debug.parser&&console.log(t,g),g},K.utils.parsFilter=function(t){var e,n,i=[];for(t=t.trim();t;){if(!(e=t.match(/^(\w+)([^\w])(.*)$/))){if(!(e=t.match(/^(\w+)$/)))return null;i.push({name:e[1],args:[],raw:""});break}t="|"===e[2]?(i.push({name:e[1],args:[],raw:""}),e[3]):(n=K.utils.parsArguments(e[3],{stop:"|"}),i.push({name:e[1],args:n.result,raw:e[3].slice(0,n.length)}),e[3].slice(n.length+1).trim())}return{result:i}},K.utils.parsArguments=function(t,e){var n,i,o,a,r,s,l,c;for(e=e||{},i="",a=r=0,c=l=!(o=[]),s=function(){i&&(o.push(i),i="")};r<=t.length;)if(n=t[r]||"",r++,l)i+=n,'"'===n&&(l=!1);else if(c)i+=n,"'"===n&&(c=!1);else if('"'!==n)if("'"!==n)if(a)i+=n,"("===n&&a++,")"===n&&a--;else if(" "!==n&&","!==n){if(e.stop&&e.stop===n){s();break}"("===n&&(a=1),i+=n}else s();else i+=n,c=!0;else i+=n,l=!0;return s(),{result:o,length:r-1}},K.utils.pars_start_tag="{{",K.utils.pars_finish_tag="}}",U=function(r){var i=K.utils.pars_start_tag,s=K.utils.pars_finish_tag,l=[],c=0,e=0,u=function(t){t=r.substring(e,c-(t=t||1));return e=c,t},p=null,h=function(t,e,n){var i,o,a;for(t||(p={type:"expression",list:[]},l.push(p)),i=null;c<r.length;){if(o=i+(i=r[c]),a=r[c+=1],i===e)return;if(!n){if(o===s&&0===t)return p.list.push(u(2)),!0;"("===i?h(t+1,")"):"{"===i?h(t+1,"}"):'"'===i?h(t+1,'"',!0):"'"===i?h(t+1,"'",!0):"|"===i&&0===t&&("|"===a?c+=1:p.list.push(u()))}}};return function(){for(var t,e,n=null;c<r.length;)if(e=n,n=r[c],c+=1,e+n===i){if((e=u(2))&&l.push({type:"text",value:e}),!h(0))throw"Wrong expression"+r;n=null}if(t=u(-1))return l.push({type:"text",value:t})}(),K.debug.parser&&console.log("parsText",l),l},V={},W=function(i){var o,a;return function(){for(var t=[],e=0,n=i.length;e<n;e++)o=i[e],a={type:o.type,value:o.value},o.list&&(a.list=o.list.slice()),t.push(a);return t}()},K.utils.parsText=function(t){var e=V[t];return e||(V[t]=e=U(t)),W(e)},K.utils.compile=X={},X.cache={},X.Function=Function,X.expression=function(e,n){var t,i,o,a,r,s;if(n=n||{},r=(e=e.trim())+"#",r+=n.no_return?"+":"-",r+=n.string?"s":"v",n.input&&(r+=n.input.join(",")),a=X.cache[r])return a;i=(a=K.utils.parsExpression(e,{input:n.input})).result,n.no_return||!1?s="var $$;"+i:n.string&&!a.filter?(s="var $$, __ = ("+i+"); return '' + (__ || (__ == null?'':__))",a.rawExpression="(__="+i+") || (__ == null?'':__)"):s="var $$;return ("+i+")";try{o=n.input?((t=n.input.slice()).unshift("$$scope"),t.push(s),X.Function.apply(null,t)):X.Function("$$scope",s)}catch(t){throw K.exceptionHandler(t,"Wrong expression: "+e,{src:e,cfg:n}),"Wrong expression: "+i}return a.fn=o,X.cache[r]=a},X.cacheText={},X.buildText=function(t,e){var n,i,o,a,r,s=X.cacheText[t];if(s)return function(){return s.call(e)};for(r=[],o=i=0,a=e.length;i<a;o=++i)"expression"===(n=e[o]).type?n.fn?r.push("this["+o+"].fn(this.scope)"):r.push("((x=this["+o+"].value) || (x == null?'':x))"):n.value&&(n=n.value.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n"),r.push('"'+n+'"'));return r=r.join(" + "),s=X.Function("var x; return ("+r+")"),X.cacheText[t]=s,function(){return s.call(e)}},X.cacheSimpleText={},X.buildSimpleText=function(t,e){var n,i,o,a,r,s,l=t?X.cacheSimpleText[t]:null;if(l||!e)return l||null;for(r=[],s=[],o=i=0,a=e.length;i<a;o=++i)"expression"===(n=e[o]).type?(r.push("("+n.re+")"),n.simpleVariables&&s.push.apply(s,n.simpleVariables)):n.value&&(n=n.value.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n"),r.push('"'+n+'"'));return r=r.join(" + "),l={fn:X.Function("$$scope","var $$, __; return ("+r+")"),simpleVariables:s},t&&(X.cacheSimpleText[t]=l),l},G=function(t){var e,n,i;if(!t.length)return"el";for(i="el",e=0,n=t.length;e<n;e++)i+=".childNodes["+t[e]+"]";return i},Y=function(t){for(var e,n,i=K.utils.parsText(t),o=0,a=i.length;o<a;o++)if("expression"===(e=i[o]).type){if(1<e.list.length)return null;if("#"===(n=e.list[0])[0])return null;if("="===n[0])return null;if("::"===n.slice(0,2))return null;if(!(n=K.utils.compile.expression(n,{string:!0})).rawExpression)throw"Error";e.re=n.rawExpression}return K.utils.compile.buildSimpleText(t,i).fn},K.core.fastBinding=function(t){if(K.option.fastBinding&&!t.directive&&!t.hook&&t.fb)return new J(t)},(J=function(t){var y,b,x=this,w=[];return x.fastWatchFn=[],y=[],(b=function(t,e){var n,i,o,a,r,s,l,c,u,p,h,d,f,v,m,g;if(t.dir)for(v=G(y),a=0,c=(h=t.dir).length;a<c;a++)n=h[a],w.push("s.dir("+x.fastWatchFn.length+", "+v+");"),x.fastWatchFn.push(n);if(t.attr)for(r=0,u=(d=t.attr).length;r<u;r++)g=(o=d[r]).value,s=o.attrName,v=G(y),i=Y(g),m=g.replace(/"/g,'\\"').replace(/\n/g,"\\n"),i?(w.push('s.fw("'+m+'", '+x.fastWatchFn.length+", "+v+', "'+s+'");'),x.fastWatchFn.push(i)):w.push("s.wt('"+m+"', "+v+", '"+s+"');");if(t.text&&(v=G(y),i=Y(t.text),m=t.text.replace(/"/g,'\\"').replace(/\n/g,"\\n"),i?(w.push('s.fw("'+m+'", '+x.fastWatchFn.length+", "+v+");"),x.fastWatchFn.push(i)):w.push('s.wt("'+m+'", '+v+");")),t.children)for(l=0,p=(f=t.children).length;l<p;l++)o=f[l],y.length=e+1,y[e]=o.index,b(o.fb,e+1)})(t.fb,0),w=w.join("\n"),x.resultFn=K.utils.compile.Function("s","el","f$",w),this}).prototype.bind=function(t,e){this.currentCD=t,this.resultFn(this,e,ct)},J.prototype.dir=function(t,e){var n=this.fastWatchFn[t],i=this.currentCD,t=new A({attrName:n.attrName,attrArgument:n.attrArgument,changeDetector:i,fbData:n.fbData}),t=n.fb.call(t,i.scope,e,n.value,t);t&&t.start&&t.start()},J.prototype.fw=function(t,e,n,i){var o=this.currentCD,a=this.fastWatchFn[e],e=a(o.locals),i={isStatic:!1,isArray:!1,extraLoop:!1,deep:!1,value:e,callback:null,exp:a,src:t,onStop:null,el:n,ea:i||null};o.watchList.push(i),T(o.scope,i,e)},J.prototype.wt=function(t,e,n){this.currentCD.watchText(t,null,{element:e,elementAttr:n})},K.hooks.attribute.unshift({code:"events",fn:function(){var t=this.attrName.match(/^\@([\w\.\-]+)$/);t&&(this.ns="al",this.name="on",this.attrArgument=t[1])}}),K.hooks.eventModifier={},(ot=function(t,n){return K.hooks.eventModifier[t]={event:["keydown","keypress","keyup"],fn:function(t,e){t[n]||(e.stop=!0)}}})("alt","altKey"),ot("control","ctrlKey"),ot("ctrl","ctrlKey"),ot("meta","metaKey"),ot("shift","shiftKey"),K.hooks.eventModifier.self=function(t,e){if(t.target!==e.element)return e.stop=!0},K.hooks.eventModifier.once={beforeExec:function(t,e){return e.unbind()}},Q=function(t,e){var n,i,o,a,r,s={};if("string"==typeof t?s.event=t:"object"==typeof t&&t.event&&(s.event=t.event),"string"==typeof s.event&&(s.event=s.event.split(/\s+/)),e&&s.event){for(o=!1,i=0,a=(r=s.event).length;i<a;i++)if(n=r[i],0<=e.indexOf(n)){o=!0;break}if(!o)return null}return ct.isFunction(t)?s.fn=t:t.fn&&(s.fn=t.fn),t.beforeExec&&(s.beforeExec=t.beforeExec),t.init&&(s.init=t.init),s},K.d.al.on=function(t,e,n,i){var u,o;i.attrArgument&&(K.option.removeAttribute&&(e.removeAttribute(i.attrName),i.fbElement&&i.fbElement.removeAttribute(i.attrName)),o=i.attrArgument.split(".")[0],(u=function(){}).prototype=it(i.attrArgument,q[o]),n&&(u.prototype.fn=i.changeDetector.compile(n,{no_return:!0,input:["$event","$element","$value"]})),u.prototype.expression=n,i.fastBinding=function(t,i,e,n){var o,a,r,s,l,c=new u;for(c.scope=t,c.element=i,c.cd=n.changeDetector,o=function(t){return et(c,t)},r=0,s=(l=c.eventList).length;r<s;r++)a=l[r],ct.on(i,a,o);c.initFn&&c.initFn(t,i,e,n),c.unbind=function(){for(var t=c.eventList,e=0,n=t.length;e<n;e++)a=t[e],ct.off(i,a,o)},n.changeDetector.watch("$destroy",c.unbind)},i.fastBinding(t,e,n,i))},nt={enter:13,tab:9,delete:46,backspace:8,esc:27,space:32,up:38,down:40,left:37,right:39},q={click:{stop:!0,prevent:!0},dblclick:{stop:!0,prevent:!0},submit:{stop:!0,prevent:!0},keyup:{filterByKey:!0},keypress:{filterByKey:!0},keydown:{filterByKey:!0}},it=function(t,e){var n,i,o,a,r,s,l={attrArgument:t,throttle:null,throttleTime:0,debounce:null,debounceId:null,initFn:null,eventList:null,stop:(e=e||{}).stop||!1,prevent:e.prevent||!1,scan:!0,modifiers:[]},t=(n=t.split("."))[0],c=null;for((r=K.hooks.eventModifier[t])&&(r=Q(r)).event&&(l.eventList=r.event,r.fn&&l.modifiers.push(r),r.init&&(l.initFn=r.init)),l.eventList||(l.eventList=[t]),i=0,a=(s=n.slice(1)).length;i<a;i++)"stop"!==(o=s[i])?"prevent"!==o?"nostop"!==o?"noprevent"!==o?"noscan"!==o?"throttle-"!==o.substring(0,9)?"debounce-"!==o.substring(0,9)?(r=K.hooks.eventModifier[o])?(r=Q(r,l.eventList))&&l.modifiers.push(r):e.filterByKey&&((c=null===c?{}:c)[o=nt[o]?nt[o]:o]=!0):l.debounce=Number(o.substring(9)):l.throttle=Number(o.substring(9)):l.scan=!1:l.prevent=!1:l.stop=!1:l.prevent=!0:l.stop=!0;return l.filterByKey=c,l},tt=function(t,e){t=t.element;return"checkbox"===t.type?t.checked:"radio"===t.type?t.value||t.checked:(e.component?e:t).value},Z=function(e,n){for(var t,i=e.modifiers,o=0,a=i.length;o<a;o++)(t=i[o]).beforeExec&&t.beforeExec(n,e);if(e.fn)try{e.fn(e.cd.locals,n,e.element,tt(e,n))}catch(t){K.exceptionHandler(t,"Error in event: "+e.attrArgument+" = "+e.expression,{attr:e.attrArgument,exp:e.expression,scope:e.scope,cd:e.cd,element:e.element,event:n})}e.scan&&e.cd.scan()},et=function(t,e){var n,i,o,a,r,s;if(!t.filterByKey||t.filterByKey[e.keyCode]){if(t.modifiers.length)for((n=function(){}).prototype=t,(i=new n).stop=!1,o=0,a=(s=t.modifiers).length;o<a;o++)if((r=s[o]).fn&&(r.fn(e,i),i.stop))return;t.prevent&&e.preventDefault(),t.stop&&e.stopPropagation(),t.debounce?(t.debounceId&&clearTimeout(t.debounceId),t.debounceId=setTimeout(function(){return t.debounceId=null,Z(t,e)},t.debounce)):t.throttle?t.throttleTime<Date.now()&&(t.throttleTime=Date.now()+t.throttle,Z(t,e)):Z(t,e)}},K.hooks.attribute.unshift({code:"directDirective",fn:function(){var l,t=this.attrName.match(/^(.*)\!$/);t&&(t=t[1].replace(/(-\w)/g,function(t){return t.substring(1).toUpperCase()}),l=this.cd.locals[t]||K.ctrl[t]||K.option.globalController&&window[t],ct.isFunction(l)?this.directive=function(t,e,n,i){var o=i.changeDetector;if(n){for(var a=K.utils.parsArguments(n),r=Array(a.result.length),s=0;s<a.result.length;s++)r[s]=K.utils.compile.expression(a.result[s],{input:["$element","$env"]}).fn(o.locals,e,i);l.apply(o,r)}else l.call(o,t,e,n,i)}:(this.result="noDirective",this.stop=!0))}}),K.hooks.attribute.unshift({code:"elementVariable",fn:function(){var t=this.attrName.match(/^#([\w\.]*)$/);t&&(this.directive=ht,this.attrArgument=t[1])}}),K.d.al.value=function(t,e,n,i){var o,a;return i.fastBinding=!0,i.on(e,"input",o=function(){i.setValue(n,e.value),a.refresh(),i.scan()}),i.on(e,"change",o),a=i.watch(n,function(t){return e.value=t=null==t?"":t,"$scanNoChanges"})},K.d.al.checked=function(t,n,e,i){var o=i.fbData={opt:{},watch:[]};function a(t){var e=i.takeAttr(t);return K.option.removeAttribute&&(n.removeAttribute(t),i.fbElement&&i.fbElement.removeAttribute(t)),e}function r(t,e){var n=a(e);if(n)return o.opt[t]=n,1;e=a(":"+e)||a("al-attr."+e);return e&&(o.watch.push([e,t]),1)}function l(n,i,o){for(var t in i.fbData.opt)n[t]=i.fbData.opt[t];for(var e=0,a=i.fbData.watch;e<a.length;e++)!function(t){var e=t[1];i.watch(t[0],function(t){n[e]=t,o()})}(a[e])}r("value","value")?i.fastBinding=function(t,e,n,i){var o,a=null;function r(){return e.checked=a&&0<=a.indexOf(s.value),"$scanNoChanges"}var s={};l(s,i,r),o=i.watch(n,function(t){a=t,Array.isArray(a)||(a=null),r()},{isArray:!0}),i.on(e,"change",function(){var t;a||(a=[],i.setValue(n,a)),e.checked?a.indexOf(s.value)<0&&a.push(s.value):0<=(t=a.indexOf(s.value))&&a.splice(t,1),o.refresh(),i.scan()})}:(r("true","true-value"),r("false","false-value"),i.fastBinding=function(t,e,n,i){var o,a,r={true:!0,false:!1};function s(){return e.checked=o===r.true,"$scanNoChanges"}l(r,i,s),a=i.watch(n,function(t){o=t,s()}),i.on(e,"change",function(){o=e.checked?r.true:r.false,i.setValue(n,o),a.refresh(),i.scan()})}),i.fastBinding(t,n,e,i)},K.d.al.if=function(t,e,n,i){var o;return i.elementCanBeRemoved?(K.exceptionHandler(null,i.attrName+" can't control element because of "+i.elementCanBeRemoved,{scope:t,element:e,value:n,env:i}),{}):(i.stopBinding=!0,o={item:null,childCD:null,base_element:null,top_element:null,start:function(){o.prepare(),o.watchModel()},prepare:function(){o.base_element=e,o.top_element=document.createComment(" "+i.attrName+": "+n+" "),ct.before(e,o.top_element),ct.remove(e)},updateDom:function(t){t?o.insertBlock(t):o.removeBlock()},removeBlock:function(){o.childCD&&(o.childCD.destroy(),o.childCD=null,o.removeDom(o.item),o.item=null)},insertBlock:function(){o.childCD||(o.item=o.base_element.cloneNode(!0),o.insertDom(o.top_element,o.item),o.childCD=i.changeDetector.new(),K.bind(o.childCD,o.item,{skip_attr:i.skippedAttr(),elementCanBeRemoved:i.attrName}))},watchModel:function(){i.watch(n,o.updateDom)},removeDom:function(t){ct.remove(t)},insertDom:function(t,e){ct.after(t,e)}})},K.d.al.ifnot=function(t,e,n,i){var o=K.d.al.if(t,e,n,i);return o.updateDom=function(t){t?o.removeBlock():o.insertBlock()},o},K.directives.al.repeat={restrict:"AM",init:function(t,C,a,W){var s,U;return W.elementCanBeRemoved?(K.exceptionHandler(null,W.attrName+" can't control element because of "+W.elementCanBeRemoved,{scope:t,element:C,value:a,env:W}),{}):(W.stopBinding=!0,s=W.changeDetector,U={start:function(){U.parsExpression(),U.prepareDom(),U.buildUpdateDom(),U.watchModel()},parsExpression:function(){var t,e=a.trim();if("("===e[0])if(U.objectMode=!0,t=e.match(/\((\w+),\s*(\w+)\)\s+in\s+(.+)\s+orderBy:(.+)\s*$/))U.objectKey=t[1],U.objectValue=t[2],U.expression=t[3]+(" | toArray:"+U.objectKey+","+U.objectValue+" | orderBy:"+t[4]),U.nameOfKey="$item",U.trackExpression="$item."+U.objectKey;else{if(!(t=e.match(/\((\w+),\s*(\w+)\)\s+in\s+(.+)\s*$/)))throw"Wrong repeat: "+a;U.objectKey=t[1],U.objectValue=t[2],U.expression=t[3]+(" | toArray:"+U.objectKey+","+U.objectValue),U.nameOfKey="$item",U.trackExpression="$item."+U.objectKey}else{if((t=e.match(/(.*) track by ([\w\.\$\(\)]+)/))&&(U.trackExpression=t[2],e=t[1]),!(t=e.match(/\s*(\w+)\s+in\s+(.+)/)))throw"Wrong repeat: "+a;U.nameOfKey=t[1],U.expression=t[2]}},watchModel:function(){var t=U.objectMode?{deep:!0}:{isArray:!0};U.watch=s.watch(U.expression,U.updateDom,t)},prepareDom:function(){var t,e,n,i,o;if(8===C.nodeType){for(U.top_element=C,U.element_list=e=[],t=C.nextSibling;t;){if(8===t.nodeType&&"/directive:"===(o=t.nodeValue.trim().split(/\s+/))[0]&&"al-repeat"===o[1]){W.skipToElement=t;break}e.push(t),t=t.nextSibling}for(n=0,i=e.length;n<i;n++)t=e[n],ct.remove(t)}else U.base_element=C,U.top_element=document.createComment(" "+a+" "),ct.before(C,U.top_element),ct.remove(C),K.option.removeAttribute&&C.removeAttribute(W.attrName)},makeChild:function(t,e,n){var i=s.new(null,{locals:!0});return U.updateLocals(i,t,e,n),i},updateLocals:function(t,e,n,i){t=t.locals;U.objectMode?(t[U.objectKey]=e[U.objectKey],t[U.objectValue]=e[U.objectValue]):t[U.nameOfKey]=e,t.$index=n,t.$first=0===n,t.$last=n===i.length-1},rawUpdateDom:function(t,e){for(var n,i,o,a,r=0,s=t.length;r<s;r++)n=t[r],ct.remove(n);for(o=0,a=e.length;o<a;o++)i=e[o],ct.after(i.after,i.element)},buildUpdateDom:function(){return U.updateDom=(R=[],_=null,k=H=0,z=W.skippedAttr(),P="$index"===U.trackExpression?(o={},F=function(t){return o[H]||null},I=function(t){null!=t.$id&&delete o[t.$id]},function(t,e){e.$id=H,o[H]=e}):U.trackExpression?(o={},a=s.compile(U.trackExpression,{input:["$id",U.nameOfKey]}),n=function(t,e){return a(s.scope,t,e)},i=function(t){var e=t.$alite_id;return e=e||(t.$alite_id=K.utils.getId())},F=function(t){t=n(i,t);return null!=t?o[t]:null},I=function(t){t=t.$id;null!=t&&delete o[t]},function(t,e){t=n(i,t);e.$id=t,o[t]=e}):window.Map?(o=new Map,F=function(t){return o.get(t)},I=function(t){o.delete(t.item)},function(t,e){o.set(t,e)}):(o={},F=function(t){return"object"!=typeof t?o[t]||null:(t=t.$alite_id)?o[t]:null},I=function(t){var e=t.$id;o[e]&&(t.$id=null,delete o[e])},function(t,e){var n;"object"==typeof t?(n=K.utils.getId(),t.$alite_id=n,e.$id=n,o[n]=e):(e.$id=t,o[t]=e)}),r=[],V=function(t){var e,n=typeof t;if("object"==n)return t&&t.length?t:[];if("number"==n)e=Math.floor(t);else if("string"==n&&(e=Math.floor(t),isNaN(e)))return[];if(e<r.length)r.length=e;else for(;r.length<e;)r.push(r.length);return r},U.element_list?function(t){for(var o,a,r,e,s,n,i,l,c,u,p,h,d,f,v,m,g,y,b,x,w,_,k,C,$,S,D,E,A,T,j=V(t),L=U.top_element,B=[],M=[],O=0,N=R.length;O<N;O++)(k=R[O]).active=!1;for(H=u=0,d=j.length;u<d;H=++u)l=j[H],(k=F(l))&&(k.active=!0);for(e=[],p=0,f=R.length;p<f;p++)if(!(k=R[p]).active){for(k.prev&&(k.prev.next=k.next),k.next&&(k.next.prev=k.prev),I(k),k.CD.destroy(),h=0,v=(E=k.element_list).length;h<v;h++)s=E[h],e.push(s);k.next=null,k.prev=null,k.element_list=null}for(D=null,S=!(o=[]),n=U.element_list.length-1,H=x=0,m=j.length;x<m;H=++x)if(l=j[H],k=F(c=l))if(U.updateLocals(k.CD,l,H,j),k.prev!==D){for((k.prev=D)&&(D.next=k),C=0,y=(T=k.element_list).length;C<y;C++)s=T[C],B.push({element:s,after:L}),L=s;(D=k).active=S=!0,M.push(k)}else{if(S)for(w=0,g=(A=k.element_list).length;w<g;w++)s=A[w],B.push({element:s,after:L}),L=s;L=(D=k).element_list[n],k.active=!0,M.push(k)}else r=U.makeChild(c,H,j),c=function(){for(var t=U.element_list,e=[],n=0,i=t.length;n<i;n++)a=t[n],s=a.cloneNode(!0),o.push({cd:r,el:s}),B.push({element:s,after:L}),e.push(L=s);return e}(),P(l,k={CD:r,element_list:c,prev:D,next:null,active:!0,item:l}),D?(_=D.next,((D.next=k).next=_)&&(_.prev=k)):0===H&&R[0]&&(_=R[0],(k.next=_).prev=k),D=k,M.push(k);for(R=M,U.rawUpdateDom(e,B),e.length=0,$=B.length=0,b=o.length;$<b;$++)i=o[$],K.bind(i.cd,i.el,{skip_attr:z,elementCanBeRemoved:W.attrName,noDomOptimization:!0})}:function(t){var e,n,i,o,a,r,s,l,c,u,p,h,d,f,v,m,g,y,b,x=V(t),w=U.top_element;for(k++,i=[],m=[],y=null,g=!(e=[]),H=r=0,p=x.length;r<p;H=++r)l=x[H],(v=F(b=l))?(U.updateLocals(v.CD,l,H,x),v.prev!==y?((v.prev=y)&&(y.next=v),i.push({element:v.element,after:w}),g=!0,w=v.element,(y=v).version=k):(g&&i.push({element:v.element,after:y.element}),w=(y=v).element,v.version=k),m.push(v)):(n=U.makeChild(b,H,x),C=U.base_element.cloneNode(!0),null===_?(a=U.base_element.cloneNode(!0),b=K.bind(n,C,{skip_attr:z,elementCanBeRemoved:W.attrName,noDomOptimization:!0,fbElement:a}),(_=K.core.fastBinding(b)||!1)&&(U.base_element=a)):e.push({cd:n,el:C}),i.push({element:C,after:w}),P(l,v={CD:n,element:w=C,prev:y,next:null,version:k,item:l}),y?(f=y.next,((y.next=v).next=f)&&(f.prev=v)):0===H&&R[0]&&(f=R[0],(v.next=f).prev=v),y=v,m.push(v));for(o=[],c=0,h=R.length;c<h;c++)(v=R[c]).version!==k&&(v.prev&&(v.prev.next=v.next),v.next&&(v.next.prev=v.prev),I(v),v.CD.destroy(),o.push(v.element),v.next=null,v.prev=null,v.element=null);for(R=m,U.rawUpdateDom(o,i),o.length=0,u=i.length=0,d=e.length;u<d;u++)s=e[u],_?_.bind(s.cd,s.el):K.bind(s.cd,s.el,{skip_attr:z,elementCanBeRemoved:W.attrName,noDomOptimization:!0})});var n,i,o,I,F,a,R,H,_,k,z,P,r,V}})}},K.d.al.init=function(e,n,i,o){var a,t,r,s;K.option.removeAttribute&&(n.removeAttribute(o.attrName),o.fbElement&&o.fbElement.removeAttribute(o.attrName)),a=o.changeDetector,s=["$element"],"window"===o.attrArgument&&s.push("window");try{r=a.compile(i,{no_return:!0,input:s}),o.fastBinding=t=function(t,e,n,i){return r(i.changeDetector.locals,e,window)},t(0,n,0,o)}catch(t){K.exceptionHandler(t,"al-init, error in expression: "+i,{exp:i,scope:e,cd:a,element:n}),o.fastBinding=function(){}}},K.d.al.app={stopBinding:!0},K.d.al.stop={restrict:"AE",stopBinding:!0},K.d.al.cloak=function(t,e,n,i){e.removeAttribute(i.attrName),n&&ct.removeClass(e,n)},K.d.al.html={restrict:"AM",priority:100,modifier:{},link:function(o,a,r,s){var l;return s.elementCanBeRemoved&&8!==a.nodeType?(K.exceptionHandler(null,s.attrName+" can't control element because of "+s.elementCanBeRemoved,{scope:o,element:a,value:r,env:s}),{}):(s.stopBinding=!0,l={baseElement:null,topElement:null,activeElement:null,childCD:null,name:r,watchMode:null,start:function(){l.parsing(),l.prepare(),l.watchModel()},parsing:function(){var t,e,n,i;if(s.attrArgument)for(t=0,e=(i=s.attrArgument.split(".")).length;t<e;t++)"literal"!==(n=i[t])?"tpl"!==n?K.d.al.html.modifier[n]&&K.d.al.html.modifier[n](l,{scope:o,element:a,inputName:r,env:s}):l.watchMode="tpl":l.watchMode="literal"},prepare:function(){8===a.nodeType?(l.baseElement=null,l.topElement=a):(l.baseElement=a,l.topElement=document.createComment(" "+s.attrName+": "+r+" "),ct.before(a,l.topElement),ct.remove(a))},removeBlock:function(){var t,e,n,i;if(l.childCD&&(l.childCD.destroy(),l.childCD=null),l.activeElement){if(Array.isArray(l.activeElement))for(e=0,n=(i=l.activeElement).length;e<n;e++)t=i[e],l.removeDom(t);else l.removeDom(l.activeElement);l.activeElement=null}},insertBlock:function(t){var e,n,i;if(l.baseElement)l.activeElement=l.baseElement.cloneNode(!1),l.activeElement.innerHTML=t,l.insertDom(l.topElement,l.activeElement),l.childCD=s.changeDetector.new(),K.bind(l.childCD,l.activeElement,{skip_attr:s.skippedAttr(),elementCanBeRemoved:s.attrName});else for((i=document.createElement("body")).innerHTML=t,e=l.topElement,l.activeElement=[],l.childCD=s.changeDetector.new();n=i.firstChild;)l.insertDom(e,n),l.activeElement.push(e=n),K.bind(l.childCD,e,{skip_attr:s.skippedAttr(),elementCanBeRemoved:s.attrName})},updateDom:function(t){l.removeBlock(),t&&l.insertBlock(t)},removeDom:function(t){ct.remove(t)},insertDom:function(t,e){ct.after(t,e)},watchModel:function(){"literal"===l.watchMode?l.updateDom(l.name):"tpl"===l.watchMode?s.watchText(l.name,l.updateDom):s.watch(l.name,l.updateDom)}})}},K.d.al.html.modifier.id=function(n){return n.updateDom=function(t){var e;n.removeBlock(),(t=document.getElementById(t))&&(e=t.innerHTML)&&n.insertBlock(e)}},K.d.al.html.modifier.url=function(e){return e.loadHtml=function(t){ct.ajax(t)},e.updateDom=function(t){t?e.loadHtml({cache:!0,url:t,success:function(t){e.removeBlock(),e.insertBlock(t)},error:e.removeBlock}):e.removeBlock()}},K.d.al.html.modifier.scope=function(i,o){var a,r,t=i.name.split(":");if(2===t.length)i.name=t[0],r=t[1];else{if(t=i.name.match(/(.+)\:\s*\:\:([\d\w]+)$/))a=!0;else if(a=!1,!(t=i.name.match(/(.+)\:\s*([\.\w]+)$/)))throw"Wrong expression "+i.name;i.name=t[1],r=t[2]}return i.insertBlock=function(t){var e,n;i.activeElement=i.baseElement.cloneNode(!1),i.activeElement.innerHTML=t,i.insertDom(i.topElement,i.activeElement),t=o.env.changeDetector,(e=i.childCD=t.new(null,{locals:!0})).locals.outer=null,n=t.watch(r,function(t){return e.locals.outer=t},{oneTime:a}),i.childCD.watch("$destroy",function(){return n.stop()}),K.bind(i.childCD,i.activeElement,{skip_attr:o.env.skippedAttr()})}},K.d.al.html.modifier.inline=function(t,e){var n=t.prepare;return t.prepare=function(){return n(),e.env.setValue(t.name,t.baseElement.innerHTML)}},K.d.al.radio=function(t,e,n,i){var o,a=i.takeAttr("al-value"),r=a?i.eval(a):i.takeAttr("value");return i.on(e,"change",function(){i.setValue(n,r),o.refresh(),i.scan()}),o=i.watch(n,function(t){return e.checked=r===t,"$scanNoChanges"})},window.Map?((at=function(){return this.idByItem=new Map,this.itemById={},this.index=1,this}).prototype.acquire=function(t){var e="i"+this.index++;return this.idByItem.set(t,e),this.itemById[e]=t,e},at.prototype.release=function(t){var e=this.itemById[t];delete this.itemById[t],this.idByItem.delete(e)},at.prototype.replace=function(t,e){var n=this.itemById[t];this.idByItem.delete(n),this.idByItem.set(e,t),this.itemById[t]=e},at.prototype.getId=function(t){return this.idByItem.get(t)},at.prototype.getItem=function(t){return this.itemById[t]||null}):((at=function(){return this.itemById={"i#null":null},this}).prototype.acquire=function(t){var e;return null===t?"i#null":("object"==typeof t?(e=t.$alite_id)||(t.$alite_id=e=K.utils.getId()):e=""+t,this.itemById[e]=t,e)},at.prototype.release=function(t){delete this.itemById[t]},at.prototype.replace=function(t,e){this.itemById[t]=e},at.prototype.getId=function(t){return null===t?"i#null":"object"==typeof t?t.$alite_id:""+t},at.prototype.getItem=function(t){return this.itemById[t]||null}),K.d.al.select=function(t,e,n,i){var o,a,r,s,l,c=i.changeDetector.new();return i.stopBinding=!0,c.$select={mapper:a=new at},o=null,c.$select.change=function(){return K.nextTick(function(){return s(o)})},s=function(t){t=a.getId(t);return t?e.value=t:e.selectedIndex=-1},l=c.watch(n,function(t){return s(o=t)}),i.on(e,"input",r=function(t){return o=a.getItem(t.target.value),c.setValue(n,o),l.refresh(),c.scan()}),i.on(e,"change",r),K.bind(c,e,{skip_attr:i.skippedAttr()})},K.d.al.option=function(t,e,n,i){var o,a,r,s,l,i=l=i.changeDetector;for(a=0;a<=4&&!(s=l.$select);++a)l=l.parent||{};s?(r=s.mapper,o=null,i.watch(n,function(t){o?r.getId(t)!==o?(r.release(o),o=r.acquire(t),e.value=o,s.change()):r.replace(o,t):(o=r.acquire(t),e.value=o,s.change())}),i.watch("$destroy",function(){return r.release(o),s.change()})):K.exceptionHandler("","Error in al-option - al-select is not found",{cd:i,scope:i.scope,element:e,value:n})},K.hooks.attribute.unshift({code:"attribute",fn:function(){var t=this.attrName.match(/^\:([\w\.\-]+)$/);t&&("html"===(t=t[1]).split(".")[0]?(this.name="html",t=t.substring(5)):this.name="attr",this.ns="al",this.attrArgument=t)}}),rt={checked:"checked",readonly:"readOnly",value:"value",selected:"selected",muted:"muted",disabled:"disabled",hidden:"hidden"},K.d.al.attr=function(t,e,o,n){var a,r,i,s,l,c,u,p,h;if(n.attrArgument){if(i=n.attrArgument.split("."),r=i[0],c=rt[r],s=0<i.indexOf("tpl"),K.option.removeAttribute&&(e.removeAttribute(n.attrName),n.fbElement&&n.fbElement.removeAttribute(n.attrName)),a={readOnly:!0},u=null,"style"===r){if(!i[1])throw"Style is not declared";p=i[1].replace(/(-\w)/g,function(t){return t.substring(1).toUpperCase()}),u=function(t,e){return t.style[p]=e=null==e?"":e}}else"class"===r&&1<i.length?(s=!1,l=i.slice(1),u=function(t,e){var n,i,o,a,r;if(e)for(i=0,a=l.length;i<a;i++)n=l[i],ct.addClass(t,n);else for(o=0,r=l.length;o<r;o++)n=l[o],ct.removeClass(t,n)}):"focus"===r?u=function(t,e){return e?t.focus():t.blur()}:c?u=function(t,e){if(t[c]!==(e=void 0===e?null:e))return t[c]=e}:(a.element=e,a.elementAttr=r);h=s?"watchText":"watch",(s=u?function(t,e,n,i){return i.changeDetector[h](o,function(t){return u(e,t)},a)}:function(t,e,n,i){return i.changeDetector[h](o,null,{readOnly:!0,element:e,elementAttr:r})})(t,e,o,n),n.fastBinding=s}},K.d.al.model=function(t,e,n,i){var o=e.nodeName.toLowerCase();if("select"===o)return K.d.al.select.call(this,t,e,n,i);if("input"===o){if("checkbox"===e.type)return K.d.al.checked.call(this,t,e,n,i);if("radio"===e.type)return K.d.al.radio.call(this,t,e,n,i)}return K.d.al.value.call(this,t,e,n,i)},K.filters.slice=function(t,e,n){return t?n?t.slice(e,n):t.slice(e):null},st=function(t){return t<10?"0"+t:""+t},K.filters.date=function(t,e){var n,i,o,a,r;if(!t)return"";for(a=e,i=0,o=(r=[[/yyyy/g,(t=new Date(t)).getFullYear()],[/mm/g,st(t.getMonth()+1)],[/dd/g,st(t.getDate())],[/HH/g,st(t.getHours())],[/MM/g,st(t.getMinutes())],[/SS/g,st(t.getSeconds())]]).length;i<o;i++)a=a.replace((n=r[i])[0],n[1]);return a},K.filters.json={watchMode:"deep",fn:function(t){return JSON.stringify(K.utils.clone(t),null,4)}},K.filters.filter=function(t,e,n){var i,o,a,r,s,l,c,u,p,h,d;if(2===arguments.length)s=null,d=e;else{if(3!==arguments.length)return t;s=e,d=n}if(!t||null==d||""===d)return t;if(u=[],p=(""+d).toLowerCase(),s)for(o=0,l=t.length;o<l;o++)((i=t[o])[s]===d||0<=(""+i[s]).toLowerCase().indexOf(p))&&u.push(i);else for(a=0,c=t.length;a<c;a++)for(r in i=t[a])((h=i[r])===d||0<=(""+h).toLowerCase().indexOf(p))&&u.push(i);return u},K.filters.orderBy=function(t,n,i){return!t instanceof Array?null:(i=i?1:-1,t.sort(function(t,e){return t[n]<e[n]?-i:t[n]>e[n]?i:0}))},K.filters.throttle={init:function(t,e,n){var i;return e=Number(e),i=null,{onChange:function(t){return i&&clearTimeout(i),i=setTimeout(function(){return i=null,n.setValue(t),n.changeDetector.scan()},e)}}}},K.filters.toArray={init:function(t,e,o){var a,r=2===o.conf.args.length?(a=o.conf.args[0],o.conf.args[1]):(a="key","value"),s=[];return{watchMode:"deep",onChange:function(t){var e,n,i;for(n in s.length=0,t)i=t[n],(e={})[a]=n,e[r]=i,s.push(e);return o.setValue(s)}}}},K.filters.storeTo={init:function(t,e,n){return{onChange:function(t){return n.changeDetector.setValue(e,t),n.setValue(t)}}}},K.text["="]=function(t,e,n,i){e=K.utils.compile.expression(e);if(e.filters)throw"Conflict: bindonce and filters, use one-time binding";i.finally(e.fn(i.changeDetector.locals))},K.text["::"]=function(t,e,n,i){i.changeDetector.watch(e,function(t){return i.finally(t)},{oneTime:!0})},lt=K.f$,K.component=function(C,$){var t,e=C.match(/^(\w+)[\-](.+)$/),e=e?(t=e[1],e[2]):(t="$global",C);e=dt(e),K.d[t]||(K.d[t]={}),K.d[t][e]={restrict:"E",stopBinding:!0,priority:K.priority.$component,init:function(t,n,e,i){var o={$sendEvent:function(t,e){t=new CustomEvent(t);t.value=e,t.component=!0,n.dispatchEvent(t)}},a=i.changeDetector.new(),r=K.ChangeDetector(o),s=new A({element:n,attributes:i.attributes,changeDetector:r,parentChangeDetector:a});try{var l=$.call(r,o,n,s)||{}}catch(t){return void K.exceptionHandler(t,"Error in component <"+C+">: ",{element:n,scope:o,cd:r})}l.onStart&&r.watch("$finishBinding",function(){l.onStart(),r.scan()});var c=!1;a.watch("$destroy",function(){c=!0,r.destroy()}),r.watch("$destroy",function(){l.onDestroy&&l.onDestroy(),c||a.destroy()});for(var u=0,p=n.attributes;u<p.length;u++)if("#"===(b=p[u]).name[0]){var h=b.name.slice(1);if(h){l.api?a.setValue(h,l.api):a.setValue(h,o);break}}function d(t,e){var n=s.takeAttr(":"+t);if(!n){if(!(n=s.takeAttr(t)))return;e="copy"}ft({childCD:r,listener:e,name:t,parentName:n,parentCD:a})}if(l.props)if(Array.isArray(l.props))for(var f=0,v=l.props;f<v.length;f++)d(m=v[f],!0);else for(var m in l.props)d(m,l.props[m]);else for(var g=0,y=n.attributes;g<y.length;g++){var b,x=(b=y[g]).name,w=b.value;w&&((x=x.match(/^\:(.*)$/))&&ft({childCD:r,name:x[1],parentName:w,parentCD:a}))}var _=!1;if(a.watch("$onScanOnce",function(){return _=!0}),l.template&&(n.innerHTML=l.template),l.templateId){i=document.getElementById(l.templateId);if(!i)throw"No template "+l.templateId;n.innerHTML=i.innerHTML}function k(){_||a.digest(),K.bind(r,n,{skip:!0})}l.templateUrl?lt.ajax({url:l.templateUrl,cache:!0,success:function(t){n.innerHTML=t,k()},error:function(){console.error("Template is not loaded",l.templateUrl)}}):k()}}},K}g.prototype={get x(){return this.p[0]},get y(){return this.p[1]},set x(t){this.p[0]=t},set y(t){this.p[1]=t},reset:function(){return this.p=new t(2),this.p[0]=0,this.p[1]=0,this},set:function(t,e){return this.p[0]=t||0,this.p[1]=e||0,this},clone:function(){var t=new g;return t.p=this.p.slice(0),t},add:function(t){return this.p[0]=this.p[0]+t.x,this.p[1]=this.p[1]+t.y,this},sub:function(t){return this.p[0]=this.p[0]-t.x,this.p[1]=this.p[1]-t.y,this},scale:function(t){return this.p[0]*=t,this.p[1]*=t,this},distance:function(t){var e=t.x-this.p[0],t=t.y-this.p[1];return Math.hypot(e,t)},length:function(){var t=this.p[0],e=this.p[1];return Math.hypot(t,e)},rotate:function(t,e){var n=Math.sin(e),i=Math.cos(e);this.p[0]-=t.x,this.p[1]-=t.y;e=this.p[0]*i-this.p[1]*n,i=this.p[0]*n+this.p[1]*i;return this.p[0]=e+t.x,this.p[1]=i+t.y,this}},s.prototype={defaultArea:{x:0,y:0,width:0,height:0,cx:0,cy:0,angle:0},_init:function(t,e){this.plugin=t,this.$container=e,this._create()},_create:function(){this._buildDOM(),this._bind()},_buildDOM:function(){this.dom={$tool:v("<div>").addClass("vision-tool-transform"),$shape:v(document.createElementNS("http://www.w3.org/2000/svg","svg")).attr({class:"vision-shape",width:"100%",height:"100%",overflow:"hidden"}),$tl:v("<div>").addClass("vision-pointer").attr({"data-type":"tl"}),$tr:v("<div>").addClass("vision-pointer").attr({"data-type":"tr"}),$bl:v("<div>").addClass("vision-pointer").attr({"data-type":"bl"}),$br:v("<div>").addClass("vision-pointer").attr({"data-type":"br"}),$mt:v("<div>").addClass("vision-pointer").attr({"data-type":"mt"}),$mr:v("<div>").addClass("vision-pointer").attr({"data-type":"mr"}),$mb:v("<div>").addClass("vision-pointer").attr({"data-type":"mb"}),$ml:v("<div>").addClass("vision-pointer").attr({"data-type":"ml"}),$rotate:v("<div>").addClass("vision-pointer").attr({"data-type":"rotate"}),$center:v("<div>").addClass("vision-center").attr({"data-type":"center"})},this.dom.$tool.append(this.dom.$shape,this.dom.$center,this.dom.$rotate,this.dom.$mt,this.dom.$mr,this.dom.$mb,this.dom.$ml,this.dom.$tl,this.dom.$tr,this.dom.$bl,this.dom.$br),this.$container.append(this.dom.$tool)},_bind:function(){this.dom.$tool.on("mousedown",v.proxy(this._onToolMouseDown,this))},_unbind:function(){this.dom.$tool.off("mousedown",v.proxy(this._onToolMouseDown,this))},_initPoints:function(){var t=this.plugin.fn.getCanvasZoom(this.plugin),e=this.plugin.fn.getCanvasPosition(this.plugin),n=this.$container[0].getBoundingClientRect(),i=n.width/2+e.x-this.area.width*t/2,o=n.height/2+e.y-this.area.height*t/2,n=this.area.x*t+i,e=this.area.y*t+o,i=this.area.width*t,o=this.area.height*t,t=l(this.area.angle),n=new g(n,e),e=new g(n.x+i,n.y),o=new g(e.x,e.y+o),i=new g(o.x-i,o.y),a=new g((n.x+e.x)/2,(n.y+i.y)/2),r=m(t);this.points[0]=n,this.points[1]=e,this.points[2]=o,this.points[3]=i,this.points[9]=a;for(var s=0;s<4;s++)this.points[s].rotate(a,r);this._updateMiddlePoints()},_updateMiddlePoints:function(){var t=this.points[0],e=this.points[1],n=this.points[2],i=this.points[3],o=new g((t.x+e.x)/2,(t.y+e.y)/2),a=new g((e.x+n.x)/2,(e.y+n.y)/2),r=new g((n.x+i.x)/2,(n.y+i.y)/2),n=new g((i.x+t.x)/2,(i.y+t.y)/2),i=e.y-t.y,e=e.x-t.x,t=i/Math.sqrt(e*e+i*i),i=-e/Math.sqrt(e*e+i*i);this.points[4]=o,this.points[5]=a,this.points[6]=r,this.points[7]=n,this.points[8]=new g(o.x+25*t,o.y+25*i)},_draw:function(){var t;this.visible?(t=this.points,this.dom.$shape.html(`<path data-type="shape" d="
					M ${t[0].x}, ${t[0].y}
					L ${t[1].x}, ${t[1].y}
					L ${t[2].x}, ${t[2].y}
					L ${t[3].x}, ${t[3].y}
					L ${t[0].x}, ${t[0].y}
					M ${t[4].x}, ${t[4].y}
					L ${t[8].x}, ${t[8].y}
					Z" />`),this.dom.$tl.css({transform:"translate("+t[0].x+"px,"+t[0].y+"px)"}),this.dom.$tr.css({transform:"translate("+t[1].x+"px,"+t[1].y+"px)"}),this.dom.$br.css({transform:"translate("+t[2].x+"px,"+t[2].y+"px)"}),this.dom.$bl.css({transform:"translate("+t[3].x+"px,"+t[3].y+"px)"}),this.dom.$mt.css({transform:"translate("+t[4].x+"px,"+t[4].y+"px) rotate("+this.area.angle+"deg)"}),this.dom.$mr.css({transform:"translate("+t[5].x+"px,"+t[5].y+"px) rotate("+this.area.angle+"deg)"}),this.dom.$mb.css({transform:"translate("+t[6].x+"px,"+t[6].y+"px) rotate("+this.area.angle+"deg)"}),this.dom.$ml.css({transform:"translate("+t[7].x+"px,"+t[7].y+"px) rotate("+this.area.angle+"deg)"}),this.dom.$rotate.css({transform:"translate("+t[8].x+"px,"+t[8].y+"px)"}),this.dom.$center.css({transform:"translate("+t[9].x+"px,"+t[9].y+"px)"}),this.dom.$tool.addClass("vision-active")):this.dom.$tool.removeClass("vision-active")},_drag:function(t,e){for(var n=0;n<this.points.length;n++)this.points[n].add({x:t,y:e});var i=this.points[0],o=this.points[2],a=this.plugin.fn.getCanvasZoom(this.plugin),r=this.plugin.fn.getCanvasPosition(this.plugin),s=this.$container.get(0).getBoundingClientRect(),l=s.width/2+r.x,r=s.height/2+r.y;this.area.x=(i.x-l)/a,this.area.y=(i.y-r)/a,this.area.cx=((i.x+o.x)/2-l)/a,this.area.cy=((i.y+o.y)/2-r)/a,this.layer.x=this.area.cx,this.layer.y=this.area.cy,this.plugin.rootScope.scan()},_rotate:function(t){for(var e=0;e<this.points.length;e++)this.points[e].rotate(this.center_off,t);this.area.angle=l(this.area.angle+180*t/Math.PI),this.layer.angle=this.area.angle,this.plugin.rootScope.scan()},_resize:function(t,e,n){var i,o,a,r,s=new g(e,n),l=m(this.area.angle),c=this.points[0],u=this.points[2],p=this.plugin.fn.getCanvasZoom(this.plugin),h=this.plugin.fn.getCanvasPosition(this.plugin),d=this.$container.get(0).getBoundingClientRect(),f=d.width/2+h.x,h=d.height/2+h.y;switch(t){case"tl":case"ml":i=this.br_off.clone();break;case"tr":case"mt":i=this.bl_off.clone();break;case"br":case"mr":i=this.tl_off.clone();break;case"bl":case"mb":i=this.tr_off.clone()}switch(o=new g((i.x+s.x)/2,(i.y+s.y)/2),s.rotate(o,-l),i.rotate(o,-l),t){case"tl":a=-s.x+i.x,r=-s.y+i.y,e=i.x-a,n=i.y-r;break;case"ml":a=-s.x+i.x,s.set(i.x-a,i.y),s.rotate(o,l),i.rotate(o,l),o.set((this.tr_off.x+s.x)/2,(this.tr_off.y+s.y)/2),s.rotate(o,-l),i.rotate(o,-l),a=-s.x+i.x,r=this.area.height*p,e=i.x-a,n=i.y-r;break;case"tr":a=s.x-i.x,r=-s.y+i.y,e=i.x,n=i.y-r;break;case"mt":r=-s.y+i.y,s.set(i.x,i.y-r),s.rotate(o,l),i.rotate(o,l),o.set((this.br_off.x+s.x)/2,(this.br_off.y+s.y)/2),s.rotate(o,-l),i.rotate(o,-l),a=this.area.width*p,r=-s.y+i.y,e=i.x,n=i.y-r;break;case"br":a=s.x-i.x,r=s.y-i.y,e=i.x,n=i.y;break;case"mr":a=s.x-i.x,s.set(i.x+a,i.y),s.rotate(o,l),i.rotate(o,l),o.set((this.bl_off.x+s.x)/2,(this.bl_off.y+s.y)/2),s.rotate(o,-l),i.rotate(o,-l),a=s.x-i.x,r=this.area.height*p,e=i.x,n=i.y;break;case"bl":a=-s.x+i.x,r=s.y-i.y,e=i.x-a,n=i.y;break;case"mb":r=s.y-i.y,s.set(i.x,i.y+r),s.rotate(o,l),i.rotate(o,l),o.set((this.tl_off.x+s.x)/2,(this.tl_off.y+s.y)/2),s.rotate(o,-l),i.rotate(o,-l),a=this.area.width*p,r=s.y-i.y,e=i.x-a,n=i.y}o.set(e+a/2,n+r/2),this.points[0].set(e,n),this.points[1].set(e+a,n),this.points[2].set(e+a,n+r),this.points[3].set(e,n+r),this.points[9].set(o.x,o.y);for(var v=0;v<4;v++)this.points[v].rotate(o,l);this._updateMiddlePoints(),this.area.x=(c.x-f)/p,this.area.y=(c.y-h)/p,this.area.cx=((c.x+u.x)/2-f)/p,this.area.cy=((c.y+u.y)/2-h)/p,this.area.width=a/p,this.area.height=r/p,this.layer.x=this.area.cx,this.layer.y=this.area.cy,this.layer.width=this.area.width,this.layer.height=this.area.height,this.plugin.rootScope.scan()},_onToolMouseDown:function(t){t.preventDefault(),t.stopImmediatePropagation(),this.type=v(t.target).data("type"),this.tl_off=this.points[0].clone(),this.tr_off=this.points[1].clone(),this.br_off=this.points[2].clone(),this.bl_off=this.points[3].clone(),this.center_off=this.points[9].clone(),this.cursor={offset:{x:this.dom.$tool.offset().left,y:this.dom.$tool.offset().top},start:{x:0,y:0},prev:{x:0,y:0},current:{x:0,y:0}},this.cursor.start.x=this.cursor.prev.x=this.cursor.current.x=t.pageX-this.cursor.offset.x,this.cursor.start.y=this.cursor.prev.y=this.cursor.current.y=t.pageY-this.cursor.offset.y,v(document).on("mousemove",v.proxy(this._onToolMouseMove,this)),v(document).on("mouseup",v.proxy(this._onToolMouseUp,this))},_onToolMouseMove:function(t){switch(this.cursor.prev.x=this.cursor.current.x,this.cursor.prev.y=this.cursor.current.y,this.cursor.current.x=t.pageX-this.cursor.offset.x,this.cursor.current.y=t.pageY-this.cursor.offset.y,this.type){case"tl":case"tr":case"br":case"bl":case"mt":case"mr":case"mb":case"ml":this._resize(this.type,this.cursor.current.x,this.cursor.current.y);break;case"shape":var e=this.cursor.current.x-this.cursor.prev.x,n=this.cursor.current.y-this.cursor.prev.y;this._drag(e,n);break;case"rotate":e=Math.atan2(this.cursor.prev.y-this.center_off.y,this.cursor.prev.x-this.center_off.x),n=Math.atan2(this.cursor.current.y-this.center_off.y,this.cursor.current.x-this.center_off.x);this._rotate(n-e)}this._draw()},_onToolMouseUp:function(t){v(document).off("mousemove",v.proxy(this._onToolMouseMove,this)),v(document).off("mouseup",v.proxy(this._onToolMouseUp,this))},init:function(t){this.end(),this.layer=t,this.area=v.extend(!0,{},this.defaultArea,{x:t.x,y:t.y,width:t.width,height:t.height,cx:0,cy:0,angle:t.angle}),this.area.cx=this.area.x+this.area.width/2,this.area.cy=this.area.y+this.area.height/2,this._initPoints()},start:function(){this.visible||(this.visible=!0,this._draw())},end:function(){this.visible&&(this.visible=!1,this.layer=null,this.area=v.extend(!0,{},this.defaultArea),this._initPoints(),this._draw())},update:function(){this.init(this.layer),this.start()},isVisible:function(){return this.visible}},c.prototype={_init:function(t,e){this.plugin=t,this.$container=e,this._create()},_create:function(){this._buildDOM(),this._bind()},_buildDOM:function(){this.dom={$tool:v("<div>").addClass("vision-tool-rect-drawing"),$canvas:v(document.createElementNS("http://www.w3.org/2000/svg","svg")).attr({class:"vision-canvas",width:"100%",height:"100%",overflow:"hidden"})},this.dom.$tool.append(this.dom.$canvas),this.$container.append(this.dom.$tool)},_bind:function(){this.dom.$tool.on("pointerdown",v.proxy(this._onPointerDown,this)),this.dom.$tool.on("pointermove",v.proxy(this._onPointerMove,this)),this.dom.$tool.on("pointerup",v.proxy(this._onPointerUp,this))},_draw:function(){var t=this.rect;this.dom.$canvas.html(`<path data-type="shape" d="
					M ${t.x0}, ${t.y0}
					L ${t.x1}, ${t.y0}
					L ${t.x1}, ${t.y1}
					L ${t.x0}, ${t.y1}
					L ${t.x0}, ${t.y0}
					Z" />`)},_onPointerDown:function(t){(t=t.originalEvent).isPrimary||(this.lockDrawing=!0),0!=t.button||this.lockDrawing||(this.rect.x0=t.offsetX,this.rect.y0=t.offsetY,this.dom.$tool[0].setPointerCapture(t.pointerId))},_onPointerMove:function(t){t=t.originalEvent,this.dom.$tool[0].hasPointerCapture(t.pointerId)&&!this.lockDrawing&&(this.rect.x1=t.offsetX,this.rect.y1=t.offsetY,this._draw())},_onPointerUp:function(t){0!=(t=t.originalEvent).button||this.lockDrawing||this.dom.$tool[0].hasPointerCapture(t.pointerId)&&(this.rect.x1=t.offsetX,this.rect.y1=t.offsetY,this.end())},start:function(t){this.visible||(this.callback=t,this.visible=!0,this.dom.$tool.addClass("vision-active"))},end:function(t){if(this.visible&&t)return this.callback=null,this.rect={x0:0,y0:0,x1:0,y1:0},this._draw(),this.visible=!1,void this.dom.$tool.removeClass("vision-active");var e,n,i,o,a,r;this.visible&&(this.callback&&(e=Math.abs(this.rect.x0-this.rect.x1),n=Math.abs(this.rect.y0-this.rect.y1),i=this.plugin.fn.getCanvasZoom(this.plugin),r=this.plugin.fn.getCanvasPosition(this.plugin),o=(a=this.$container[0].getBoundingClientRect()).width/2+r.x-e/2,t=a.height/2+r.y-n/2,a=this.rect.x0<this.rect.x1?this.rect.x0:this.rect.x1,r=this.rect.y0<this.rect.y1?this.rect.y0:this.rect.y1,this.callback({x:a=(a-o)/i,y:r=(r-t)/i,w:e/i,h:n/i})),this.callback=null,this.rect={x0:0,y0:0,x1:0,y1:0},this._draw(),this.visible=!1,this.dom.$tool.removeClass("vision-active"))},isVisible:function(){return this.visible}},e=function(){function s(){for(var t=0,e={};t<arguments.length;t++){var n,i=arguments[t];for(n in i)e[n]=i[n]}return e}function c(t){return t.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}return function t(l){function r(){}function n(t,e,n){if("undefined"!=typeof document){"number"==typeof(n=s({path:"/"},r.defaults,n)).expires&&(n.expires=new Date(+new Date+864e5*n.expires)),n.expires=n.expires?n.expires.toUTCString():"";try{var i=JSON.stringify(e);/^[\{\[]/.test(i)&&(e=i)}catch(t){}e=l.write?l.write(e,t):encodeURIComponent(String(e)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),t=encodeURIComponent(String(t)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var o,a="";for(o in n)n[o]&&(a+="; "+o,!0!==n[o]&&(a+="="+n[o].split(";")[0]));return document.cookie=t+"="+e+a}}function e(t,e){if("undefined"!=typeof document){for(var n={},i=document.cookie?document.cookie.split("; "):[],o=0;o<i.length;o++){var a=i[o].split("="),r=a.slice(1).join("=");e||'"'!==r.charAt(0)||(r=r.slice(1,-1));try{var s=c(a[0]),r=(l.read||l)(r,s)||c(r);if(e)try{r=JSON.parse(r)}catch(t){}if(n[s]=r,t===s)break}catch(t){}}return t?n[t]:n}}return r.set=n,r.get=function(t){return e(t,!1)},r.getJSON=function(t){return e(t,!0)},r.remove=function(t,e){n(t,"",s(e,{expires:-1}))},r.defaults={},r.withConverter=t,r}(function(){})},"function"==typeof define&&define.amd&&(define(e),i=!0),"object"==typeof exports&&(module.exports=e(),i=!0),i||(o=window.Cookies,(a=window.Cookies=e()).noConflict=function(){return window.Cookies=o,a}),v("#vision-app-items").length?v(".vision-root .vision-toggle").on("click touchend",function(t){t.stopPropagation(),t.preventDefault();var e,n,i,o=v(this),a=o.data("id"),r=null;o.hasClass("vision-locked")||(o.addClass("vision-readonly"),r=o.hasClass("vision-checked")?(o.removeClass("vision-checked").addClass("vision-unchecked"),!1):(o.removeClass("vision-unchecked").addClass("vision-checked"),!0),e=vision_globals.ajax_url,n=vision_globals.ajax_nonce,t=vision_globals.ajax_action_update,i=vision_globals.ajax_msg_error,a={id:a,active:r},a=v.extend(!0,{},a),a=JSON.stringify(a),v.ajax({url:e,type:"POST",dataType:"json",data:{nonce:n,action:t,config:a}}).done(function(t){t&&!t.success&&(r?o.removeClass("vision-checked").addClass("vision-unchecked"):o.removeClass("vision-unchecked").addClass("vision-checked"))}).fail(function(){console.log(i)}).always(function(){o.removeClass("vision-readonly")}))}):v("#vision-app-item").length?u():v("#vision-app-settings").length&&p(),(r=h()).makeInstance=h,"function"==typeof alightInitCallback?alightInitCallback(r):"function"==typeof define?define(function(){return r}):"object"==typeof module&&"object"==typeof module.exports?module.exports=r:(r.option.globalController=!0,(window.alight=r).f$.ready(r.bootstrap))}(jQuery);